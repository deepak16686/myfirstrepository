<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" font-family="Arial, sans-serif">
  <!-- Background -->
  <rect width="1200" height="900" fill="#f8fafc"/>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-size="24" font-weight="bold" fill="#1e293b">AI Pipeline Generation - System Architecture</text>

  <!-- User Layer -->
  <rect x="50" y="70" width="1100" height="100" rx="10" fill="#e0f2fe" stroke="#0284c7" stroke-width="2"/>
  <text x="100" y="95" font-size="14" font-weight="bold" fill="#0284c7">USER INTERACTION LAYER</text>

  <!-- User Icon -->
  <circle cx="120" cy="130" r="20" fill="#0284c7"/>
  <text x="120" y="135" text-anchor="middle" font-size="16" fill="white">ðŸ‘¤</text>
  <text x="120" y="160" text-anchor="middle" font-size="10" fill="#0284c7">User</text>

  <!-- Arrow from User to Chatbot -->
  <line x1="150" y1="130" x2="250" y2="130" stroke="#0284c7" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="200" y="120" text-anchor="middle" font-size="9" fill="#64748b">"Create pipeline"</text>

  <!-- Chatbot -->
  <rect x="260" y="105" width="120" height="50" rx="8" fill="#0284c7"/>
  <text x="320" y="135" text-anchor="middle" font-size="12" fill="white">ðŸ’¬ Chatbot UI</text>

  <!-- Arrow from Chatbot to Backend -->
  <line x1="320" y1="155" x2="320" y2="190" stroke="#0284c7" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Backend Layer -->
  <rect x="50" y="200" width="1100" height="320" rx="10" fill="#f0fdf4" stroke="#16a34a" stroke-width="2"/>
  <text x="100" y="225" font-size="14" font-weight="bold" fill="#16a34a">DEVOPS TOOLS BACKEND (FastAPI :8003)</text>

  <!-- Step 1: Analyze -->
  <rect x="80" y="245" width="300" height="80" rx="8" fill="#bbf7d0" stroke="#16a34a" stroke-width="1"/>
  <text x="230" y="265" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">Step 1: Analyze Repository</text>
  <text x="100" y="285" font-size="10" fill="#166534">â€¢ Fetch files from GitLab API</text>
  <text x="100" y="300" font-size="10" fill="#166534">â€¢ Detect language (Go, Java, Python)</text>
  <text x="100" y="315" font-size="10" fill="#166534">â€¢ Detect framework &amp; package manager</text>

  <!-- Arrow -->
  <line x1="230" y1="325" x2="230" y2="345" stroke="#16a34a" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 2: Check ChromaDB -->
  <rect x="80" y="355" width="300" height="100" rx="8" fill="#bbf7d0" stroke="#16a34a" stroke-width="1"/>
  <text x="230" y="375" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">Step 2: Check ChromaDB (RL-Direct)</text>
  <text x="100" y="395" font-size="10" fill="#166534">Query: successful_pipelines collection</text>
  <text x="100" y="410" font-size="10" fill="#166534">Filter: language=go, framework=generic</text>

  <!-- Decision Diamond -->
  <polygon points="230,430 270,450 230,470 190,450" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <text x="230" y="454" text-anchor="middle" font-size="9" fill="#92400e">Found?</text>

  <!-- Yes Path -->
  <line x1="270" y1="450" x2="320" y2="450" stroke="#16a34a" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="295" y="442" font-size="9" fill="#16a34a">Yes</text>
  <rect x="330" y="430" width="140" height="40" rx="5" fill="#86efac" stroke="#16a34a" stroke-width="1"/>
  <text x="400" y="450" text-anchor="middle" font-size="10" fill="#166534">Use DIRECTLY</text>
  <text x="400" y="462" text-anchor="middle" font-size="9" fill="#166534">(No LLM call!)</text>

  <!-- No Path -->
  <line x1="190" y1="450" x2="140" y2="450" stroke="#dc2626" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <text x="165" y="442" font-size="9" fill="#dc2626">No</text>
  <rect x="20" y="430" width="110" height="40" rx="5" fill="#fecaca" stroke="#dc2626" stroke-width="1"/>
  <text x="75" y="450" text-anchor="middle" font-size="10" fill="#991b1b">Fallback to</text>
  <text x="75" y="462" text-anchor="middle" font-size="9" fill="#991b1b">Ollama LLM</text>

  <!-- Step 3: Return Files -->
  <rect x="500" y="245" width="280" height="80" rx="8" fill="#bbf7d0" stroke="#16a34a" stroke-width="1"/>
  <text x="640" y="265" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">Step 3: Return Generated Files</text>
  <text x="520" y="285" font-size="10" fill="#166534">â€¢ .gitlab-ci.yml (9-stage pipeline)</text>
  <text x="520" y="300" font-size="10" fill="#166534">â€¢ Dockerfile (multi-stage build)</text>
  <text x="520" y="315" font-size="10" fill="#166534">â€¢ model_used: "chromadb-direct"</text>

  <!-- ChromaDB Box -->
  <rect x="820" y="245" width="300" height="220" rx="10" fill="#fae8ff" stroke="#a855f7" stroke-width="2"/>
  <text x="970" y="270" text-anchor="middle" font-size="12" font-weight="bold" fill="#7c3aed">ChromaDB (Vector DB :8005)</text>

  <rect x="840" y="285" width="260" height="60" rx="5" fill="#f5d0fe" stroke="#a855f7" stroke-width="1"/>
  <text x="970" y="305" text-anchor="middle" font-size="10" font-weight="bold" fill="#7c3aed">successful_pipelines</text>
  <text x="860" y="325" font-size="9" fill="#7c3aed">Stores proven pipeline configs</text>
  <text x="860" y="338" font-size="9" fill="#7c3aed">with metadata (language, stages)</text>

  <rect x="840" y="355" width="260" height="50" rx="5" fill="#f5d0fe" stroke="#a855f7" stroke-width="1"/>
  <text x="970" y="375" text-anchor="middle" font-size="10" font-weight="bold" fill="#7c3aed">pipeline_templates</text>
  <text x="860" y="392" font-size="9" fill="#7c3aed">Reference templates for LLM</text>

  <rect x="840" y="415" width="260" height="40" rx="5" fill="#f5d0fe" stroke="#a855f7" stroke-width="1"/>
  <text x="970" y="435" text-anchor="middle" font-size="10" font-weight="bold" fill="#7c3aed">pipeline_feedback</text>
  <text x="860" y="448" font-size="9" fill="#7c3aed">Learned corrections</text>

  <!-- Arrow to ChromaDB -->
  <line x1="380" y1="405" x2="830" y2="315" stroke="#a855f7" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-purple)"/>
  <text x="600" y="345" font-size="9" fill="#a855f7">Query templates</text>

  <!-- GitLab Layer -->
  <rect x="50" y="540" width="700" height="150" rx="10" fill="#fff7ed" stroke="#ea580c" stroke-width="2"/>
  <text x="100" y="565" font-size="14" font-weight="bold" fill="#ea580c">GITLAB SERVER (:8929)</text>

  <!-- Pipeline Stages -->
  <text x="80" y="590" font-size="11" font-weight="bold" fill="#c2410c">9-Stage Pipeline:</text>

  <rect x="80" y="600" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="115" y="620" text-anchor="middle" font-size="9" fill="#c2410c">compile</text>

  <rect x="160" y="600" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="195" y="620" text-anchor="middle" font-size="9" fill="#c2410c">build</text>

  <rect x="240" y="600" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="275" y="620" text-anchor="middle" font-size="9" fill="#c2410c">test</text>

  <rect x="320" y="600" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="355" y="620" text-anchor="middle" font-size="9" fill="#c2410c">sast</text>

  <rect x="400" y="600" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="435" y="620" text-anchor="middle" font-size="9" fill="#c2410c">quality</text>

  <rect x="80" y="640" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="115" y="660" text-anchor="middle" font-size="9" fill="#c2410c">security</text>

  <rect x="160" y="640" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="195" y="660" text-anchor="middle" font-size="9" fill="#c2410c">push</text>

  <rect x="240" y="640" width="70" height="30" rx="4" fill="#fed7aa" stroke="#ea580c" stroke-width="1"/>
  <text x="275" y="660" text-anchor="middle" font-size="9" fill="#c2410c">notify</text>

  <rect x="320" y="640" width="70" height="30" rx="4" fill="#86efac" stroke="#16a34a" stroke-width="2"/>
  <text x="355" y="660" text-anchor="middle" font-size="9" fill="#166534" font-weight="bold">learn</text>
  <text x="355" y="685" text-anchor="middle" font-size="8" fill="#16a34a">RL Stage</text>

  <!-- Arrows between stages -->
  <line x1="150" y1="615" x2="160" y2="615" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>
  <line x1="230" y1="615" x2="240" y2="615" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>
  <line x1="310" y1="615" x2="320" y2="615" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>
  <line x1="390" y1="615" x2="400" y2="615" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>
  <line x1="150" y1="655" x2="160" y2="655" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>
  <line x1="230" y1="655" x2="240" y2="655" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>
  <line x1="310" y1="655" x2="320" y2="655" stroke="#ea580c" stroke-width="1" marker-end="url(#arrowhead-small)"/>

  <!-- RL Feedback Loop -->
  <rect x="820" y="540" width="330" height="150" rx="10" fill="#ecfdf5" stroke="#059669" stroke-width="2"/>
  <text x="985" y="565" text-anchor="middle" font-size="14" font-weight="bold" fill="#059669">REINFORCEMENT LEARNING LOOP</text>

  <text x="840" y="590" font-size="10" fill="#047857">On Pipeline Success:</text>
  <text x="840" y="610" font-size="9" fill="#047857">1. learn_record job triggers</text>
  <text x="840" y="625" font-size="9" fill="#047857">2. POST /api/v1/pipeline/learn/record</text>
  <text x="840" y="640" font-size="9" fill="#047857">3. Store config in ChromaDB</text>
  <text x="840" y="655" font-size="9" fill="#047857">4. Future requests use this template!</text>

  <!-- Curved arrow from learn stage to RL box -->
  <path d="M 390 655 Q 600 720 830 620" fill="none" stroke="#059669" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-green)"/>

  <!-- Arrow from RL to ChromaDB -->
  <line x1="985" y1="540" x2="985" y2="470" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="1000" y="505" font-size="9" fill="#059669">Store success</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0284c7"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#a855f7"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#059669"/>
    </marker>
    <marker id="arrowhead-small" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#ea580c"/>
    </marker>
  </defs>

  <!-- Legend -->
  <rect x="50" y="710" width="1100" height="80" rx="10" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="600" y="735" text-anchor="middle" font-size="12" font-weight="bold" fill="#475569">Legend</text>

  <rect x="80" y="750" width="20" height="20" fill="#e0f2fe" stroke="#0284c7"/>
  <text x="110" y="765" font-size="10" fill="#475569">User Layer</text>

  <rect x="220" y="750" width="20" height="20" fill="#f0fdf4" stroke="#16a34a"/>
  <text x="250" y="765" font-size="10" fill="#475569">Backend</text>

  <rect x="340" y="750" width="20" height="20" fill="#fae8ff" stroke="#a855f7"/>
  <text x="370" y="765" font-size="10" fill="#475569">ChromaDB</text>

  <rect x="460" y="750" width="20" height="20" fill="#fff7ed" stroke="#ea580c"/>
  <text x="490" y="765" font-size="10" fill="#475569">GitLab</text>

  <rect x="580" y="750" width="20" height="20" fill="#ecfdf5" stroke="#059669"/>
  <text x="610" y="765" font-size="10" fill="#475569">RL Loop</text>

  <line x1="720" y1="760" x2="780" y2="760" stroke="#64748b" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="790" y="765" font-size="10" fill="#475569">Data Flow</text>

  <rect x="900" y="750" width="60" height="20" rx="3" fill="#86efac" stroke="#16a34a"/>
  <text x="930" y="764" text-anchor="middle" font-size="9" fill="#166534">RL Stage</text>
  <text x="1000" y="765" font-size="10" fill="#475569">Learn Stage</text>
</svg>
