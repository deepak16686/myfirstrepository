<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 4200" width="1800" height="4200" font-family="Segoe UI, Arial, sans-serif">

  <!-- ============================================================ -->
  <!-- DEFINITIONS: gradients, shadows, markers, patterns            -->
  <!-- ============================================================ -->
  <defs>
    <!-- Drop shadow filter -->
    <filter id="shadow" x="-4%" y="-4%" width="110%" height="110%">
      <feDropShadow dx="2" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.15"/>
    </filter>
    <filter id="shadowLg" x="-4%" y="-4%" width="112%" height="112%">
      <feDropShadow dx="3" dy="5" stdDeviation="7" flood-color="#000" flood-opacity="0.18"/>
    </filter>
    <filter id="shadowSm" x="-2%" y="-2%" width="106%" height="106%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-color="#000" flood-opacity="0.12"/>
    </filter>
    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>

    <!-- Arrowhead markers -->
    <marker id="arrowGray" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#6b7280"/>
    </marker>
    <marker id="arrowBlue" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#2563eb"/>
    </marker>
    <marker id="arrowPurple" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#7c3aed"/>
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#16a34a"/>
    </marker>
    <marker id="arrowRed" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#dc2626"/>
    </marker>
    <marker id="arrowTeal" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#0891b2"/>
    </marker>
    <marker id="arrowAmber" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#d97706"/>
    </marker>
    <marker id="arrowWhite" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#fff"/>
    </marker>

    <!-- Gradients -->
    <linearGradient id="headerGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#1a1a2e"/>
      <stop offset="50%" stop-color="#16213e"/>
      <stop offset="100%" stop-color="#0f3460"/>
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#7c3aed"/>
      <stop offset="100%" stop-color="#6d28d9"/>
    </linearGradient>
    <linearGradient id="blueGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#2563eb"/>
      <stop offset="100%" stop-color="#1d4ed8"/>
    </linearGradient>
    <linearGradient id="greenGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#16a34a"/>
      <stop offset="100%" stop-color="#15803d"/>
    </linearGradient>
    <linearGradient id="redGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#dc2626"/>
      <stop offset="100%" stop-color="#b91c1c"/>
    </linearGradient>
    <linearGradient id="tealGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#0891b2"/>
      <stop offset="100%" stop-color="#0e7490"/>
    </linearGradient>
    <linearGradient id="amberGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#d97706"/>
      <stop offset="100%" stop-color="#b45309"/>
    </linearGradient>
    <linearGradient id="indigoGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#4f46e5"/>
      <stop offset="100%" stop-color="#4338ca"/>
    </linearGradient>
    <linearGradient id="emeraldGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#059669"/>
      <stop offset="100%" stop-color="#047857"/>
    </linearGradient>
    <linearGradient id="sectionBg1" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#f0f4ff"/>
      <stop offset="100%" stop-color="#e8eeff"/>
    </linearGradient>
    <linearGradient id="sectionBg2" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#faf5ff"/>
      <stop offset="100%" stop-color="#f3e8ff"/>
    </linearGradient>
    <linearGradient id="sectionBg3" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#f0fdf4"/>
      <stop offset="100%" stop-color="#dcfce7"/>
    </linearGradient>
    <linearGradient id="sectionBg4" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fefce8"/>
      <stop offset="100%" stop-color="#fef9c3"/>
    </linearGradient>
    <linearGradient id="sectionBg5" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fef2f2"/>
      <stop offset="100%" stop-color="#fee2e2"/>
    </linearGradient>
    <linearGradient id="rlLoopGrad" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#059669"/>
      <stop offset="100%" stop-color="#7c3aed"/>
    </linearGradient>

    <!-- Subtle dot pattern for backgrounds -->
    <pattern id="dots" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
      <circle cx="2" cy="2" r="0.6" fill="#cbd5e1" opacity="0.3"/>
    </pattern>
  </defs>

  <!-- ============================================================ -->
  <!-- CANVAS BACKGROUND                                            -->
  <!-- ============================================================ -->
  <rect width="1800" height="4200" fill="#f8fafc"/>
  <rect width="1800" height="4200" fill="url(#dots)"/>

  <!-- ============================================================ -->
  <!-- SECTION 1: HEADER                                            -->
  <!-- ============================================================ -->
  <g transform="translate(0, 0)">
    <rect width="1800" height="130" fill="url(#headerGrad)" rx="0"/>
    <!-- Decorative accent line -->
    <rect x="0" y="126" width="1800" height="4" fill="#7c3aed"/>

    <!-- Title -->
    <text x="900" y="52" text-anchor="middle" fill="#ffffff" font-size="34" font-weight="700" letter-spacing="1">AI DevOps Platform - Complete Architecture</text>
    <text x="900" y="82" text-anchor="middle" fill="#a5b4fc" font-size="17" font-weight="400">Intelligent CI/CD Pipeline Generation with Reinforcement Learning</text>

    <!-- Tech badges -->
    <g transform="translate(340, 96)">
      <rect x="0" y="0" width="72" height="22" rx="11" fill="#3b82f6" opacity="0.85"/>
      <text x="36" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Python</text>
      <rect x="82" y="0" width="72" height="22" rx="11" fill="#059669" opacity="0.85"/>
      <text x="118" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">FastAPI</text>
      <rect x="164" y="0" width="72" height="22" rx="11" fill="#2563eb" opacity="0.85"/>
      <text x="200" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Docker</text>
      <rect x="246" y="0" width="72" height="22" rx="11" fill="#7c3aed" opacity="0.85"/>
      <text x="282" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Ollama</text>
      <rect x="328" y="0" width="88" height="22" rx="11" fill="#0891b2" opacity="0.85"/>
      <text x="372" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">ChromaDB</text>
      <rect x="426" y="0" width="72" height="22" rx="11" fill="#dc2626" opacity="0.85"/>
      <text x="462" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">GitLab</text>
      <rect x="508" y="0" width="72" height="22" rx="11" fill="#d97706" opacity="0.85"/>
      <text x="544" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Redis</text>
      <rect x="590" y="0" width="88" height="22" rx="11" fill="#4f46e5" opacity="0.85"/>
      <text x="634" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">PostgreSQL</text>
      <rect x="688" y="0" width="88" height="22" rx="11" fill="#16a34a" opacity="0.85"/>
      <text x="732" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">SonarQube</text>
      <rect x="786" y="0" width="72" height="22" rx="11" fill="#ea580c" opacity="0.85"/>
      <text x="822" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Trivy</text>
      <rect x="868" y="0" width="72" height="22" rx="11" fill="#059669" opacity="0.85"/>
      <text x="904" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Nexus</text>
      <rect x="950" y="0" width="90" height="22" rx="11" fill="#6d28d9" opacity="0.85"/>
      <text x="995" y="15" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Claude Code</text>
    </g>

    <!-- Port badge -->
    <rect x="1620" y="45" width="130" height="32" rx="16" fill="rgba(255,255,255,0.15)" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
    <text x="1685" y="66" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">Backend :8003</text>
  </g>

  <!-- ============================================================ -->
  <!-- SECTION 2: USER LAYER                                        -->
  <!-- ============================================================ -->
  <g transform="translate(0, 145)">
    <!-- Section background -->
    <rect x="20" y="0" width="1760" height="195" rx="12" fill="url(#sectionBg1)" stroke="#c7d2fe" stroke-width="1" filter="url(#shadowSm)"/>
    <!-- Section label -->
    <rect x="20" y="0" width="180" height="30" rx="8" fill="url(#indigoGrad)"/>
    <text x="110" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">USER LAYER</text>

    <!-- User/Browser icon -->
    <g transform="translate(130, 75)">
      <circle cx="40" cy="20" r="18" fill="#e0e7ff" stroke="#4f46e5" stroke-width="2"/>
      <circle cx="40" cy="14" r="7" fill="#4f46e5"/>
      <path d="M26 34 Q40 42 54 34" fill="none" stroke="#4f46e5" stroke-width="2.5" stroke-linecap="round"/>
      <text x="40" y="58" text-anchor="middle" fill="#312e81" font-size="13" font-weight="600">User</text>
    </g>

    <!-- Frontend App -->
    <g transform="translate(340, 50)">
      <rect width="280" height="100" rx="10" fill="#fff" stroke="#4f46e5" stroke-width="2" filter="url(#shadow)"/>
      <rect width="280" height="28" rx="10" fill="url(#indigoGrad)"/>
      <rect x="0" y="18" width="280" height="10" fill="url(#indigoGrad)"/>
      <text x="140" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Frontend Application</text>
      <text x="140" y="52" text-anchor="middle" fill="#374151" font-size="11">HTML / CSS / JavaScript</text>
      <text x="140" y="70" text-anchor="middle" fill="#6b7280" font-size="10">Highlight.js | Marked.js</text>
      <text x="140" y="88" text-anchor="middle" fill="#6b7280" font-size="10">Chat UI | Pipeline Preview | Approval Flow</text>
    </g>

    <!-- Arrow from user to frontend -->
    <line x1="195" y1="110" x2="338" y2="110" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowGray)"/>

    <!-- Three entry points -->
    <g transform="translate(730, 55)">
      <rect width="220" height="42" rx="8" fill="#eef2ff" stroke="#4f46e5" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="18" y="17" fill="#4f46e5" font-size="16">&#x1F4AC;</text>
      <text x="44" y="20" fill="#312e81" font-size="12" font-weight="600">Chat Interface</text>
      <text x="44" y="35" fill="#6b7280" font-size="10">Natural language pipeline requests</text>
    </g>
    <g transform="translate(730, 105)">
      <rect width="220" height="42" rx="8" fill="#eef2ff" stroke="#4f46e5" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="18" y="17" fill="#4f46e5" font-size="16">&#x2699;</text>
      <text x="44" y="20" fill="#312e81" font-size="12" font-weight="600">Pipeline Generator</text>
      <text x="44" y="35" fill="#6b7280" font-size="10">Direct API pipeline generation</text>
    </g>
    <g transform="translate(990, 55)">
      <rect width="220" height="42" rx="8" fill="#eef2ff" stroke="#4f46e5" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="18" y="17" fill="#4f46e5" font-size="16">&#x1F50C;</text>
      <text x="44" y="20" fill="#312e81" font-size="12" font-weight="600">Connectivity Validator</text>
      <text x="44" y="35" fill="#6b7280" font-size="10">Health checks for all tools</text>
    </g>
    <g transform="translate(990, 105)">
      <rect width="220" height="42" rx="8" fill="#eef2ff" stroke="#4f46e5" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="18" y="17" fill="#4f46e5" font-size="16">&#x1F4CB;</text>
      <text x="44" y="20" fill="#312e81" font-size="12" font-weight="600">Unified Dashboard</text>
      <text x="44" y="35" fill="#6b7280" font-size="10">Aggregated tool status view</text>
    </g>

    <!-- Arrows from frontend to entry points -->
    <line x1="622" y1="95" x2="728" y2="78" stroke="#4f46e5" stroke-width="1.5" marker-end="url(#arrowGray)" stroke-dasharray="5,3"/>
    <line x1="622" y1="105" x2="728" y2="125" stroke="#4f46e5" stroke-width="1.5" marker-end="url(#arrowGray)" stroke-dasharray="5,3"/>
    <line x1="622" y1="90" x2="988" y2="78" stroke="#4f46e5" stroke-width="1.5" marker-end="url(#arrowGray)" stroke-dasharray="5,3"/>
    <line x1="622" y1="115" x2="988" y2="128" stroke="#4f46e5" stroke-width="1.5" marker-end="url(#arrowGray)" stroke-dasharray="5,3"/>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION: User Layer to Backend                             -->
  <!-- ============================================================ -->
  <line x1="900" y1="340" x2="900" y2="365" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>
  <text x="920" y="358" fill="#6b7280" font-size="10" font-weight="500">HTTP REST</text>

  <!-- ============================================================ -->
  <!-- SECTION 3: BACKEND API LAYER                                  -->
  <!-- ============================================================ -->
  <g transform="translate(0, 370)">
    <!-- Section background -->
    <rect x="20" y="0" width="1760" height="310" rx="12" fill="#fff" stroke="#93c5fd" stroke-width="1.5" filter="url(#shadowLg)"/>
    <!-- Section label -->
    <rect x="20" y="0" width="260" height="30" rx="8" fill="url(#blueGrad)"/>
    <text x="150" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">BACKEND API LAYER (FastAPI)</text>

    <!-- API Gateway -->
    <g transform="translate(60, 45)">
      <rect width="200" height="55" rx="8" fill="#dbeafe" stroke="#2563eb" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="100" y="24" text-anchor="middle" fill="#1e40af" font-size="14" font-weight="700">API Gateway</text>
      <text x="100" y="44" text-anchor="middle" fill="#3b82f6" font-size="12">Port 8003</text>
    </g>

    <!-- Routers box -->
    <g transform="translate(300, 38)">
      <rect width="700" height="115" rx="10" fill="#eff6ff" stroke="#93c5fd" stroke-width="1.5"/>
      <text x="350" y="20" text-anchor="middle" fill="#1e40af" font-size="13" font-weight="700">Routers</text>
      <!-- Router pills -->
      <g transform="translate(15, 30)">
        <rect x="0" y="0" width="95" height="26" rx="6" fill="#2563eb"/>
        <text x="47" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Pipeline</text>
        <rect x="105" y="0" width="72" height="26" rx="6" fill="#2563eb"/>
        <text x="141" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Chat</text>
        <rect x="187" y="0" width="78" height="26" rx="6" fill="#2563eb"/>
        <text x="226" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">GitLab</text>
        <rect x="275" y="0" width="82" height="26" rx="6" fill="#2563eb"/>
        <text x="316" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">GitHub</text>
        <rect x="367" y="0" width="100" height="26" rx="6" fill="#2563eb"/>
        <text x="417" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">SonarQube</text>
        <rect x="477" y="0" width="72" height="26" rx="6" fill="#2563eb"/>
        <text x="513" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Trivy</text>
        <rect x="559" y="0" width="72" height="26" rx="6" fill="#2563eb"/>
        <text x="595" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Nexus</text>
      </g>
      <g transform="translate(15, 66)">
        <rect x="0" y="0" width="72" height="26" rx="6" fill="#3b82f6"/>
        <text x="36" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Tools</text>
        <rect x="82" y="0" width="115" height="26" rx="6" fill="#3b82f6"/>
        <text x="139" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Connectivity</text>
        <rect x="207" y="0" width="90" height="26" rx="6" fill="#3b82f6"/>
        <text x="252" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Unified</text>
      </g>
    </g>

    <!-- Services box -->
    <g transform="translate(300, 165)">
      <rect width="700" height="115" rx="10" fill="#f5f3ff" stroke="#c4b5fd" stroke-width="1.5"/>
      <text x="350" y="20" text-anchor="middle" fill="#5b21b6" font-size="13" font-weight="700">Services</text>
      <g transform="translate(15, 30)">
        <rect x="0" y="0" width="145" height="26" rx="6" fill="#7c3aed"/>
        <text x="72" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Pipeline Generator</text>
        <rect x="155" y="0" width="120" height="26" rx="6" fill="#7c3aed"/>
        <text x="215" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Chat Service</text>
        <rect x="285" y="0" width="120" height="26" rx="6" fill="#7c3aed"/>
        <text x="345" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Self-Healing</text>
        <rect x="415" y="0" width="145" height="26" rx="6" fill="#7c3aed"/>
        <text x="487" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Dry-Run Validator</text>
      </g>
      <g transform="translate(15, 66)">
        <rect x="0" y="0" width="108" height="26" rx="6" fill="#8b5cf6"/>
        <text x="54" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">LLM Fixer</text>
        <rect x="118" y="0" width="150" height="26" rx="6" fill="#8b5cf6"/>
        <text x="193" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Pipeline Progress</text>
        <rect x="278" y="0" width="185" height="26" rx="6" fill="#8b5cf6"/>
        <text x="370" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">GitHub Pipeline Generator</text>
      </g>
    </g>

    <!-- LLM Provider Factory -->
    <g transform="translate(1060, 45)">
      <rect width="290" height="235" rx="10" fill="#faf5ff" stroke="#a78bfa" stroke-width="2" filter="url(#shadow)"/>
      <rect width="290" height="32" rx="10" fill="url(#purpleGrad)"/>
      <rect x="0" y="22" width="290" height="10" fill="url(#purpleGrad)"/>
      <text x="145" y="22" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">LLM Provider Factory</text>
      <text x="145" y="56" text-anchor="middle" fill="#6d28d9" font-size="11" font-weight="600">get_llm_provider()</text>
      <text x="145" y="74" text-anchor="middle" fill="#7c3aed" font-size="10">LLM_PROVIDER env var</text>

      <!-- Switch visualization -->
      <rect x="30" y="88" width="230" height="42" rx="6" fill="#ede9fe" stroke="#c4b5fd" stroke-width="1"/>
      <text x="145" y="106" text-anchor="middle" fill="#5b21b6" font-size="11" font-weight="600">Switch: "ollama" | "claude-code"</text>
      <text x="145" y="122" text-anchor="middle" fill="#7c3aed" font-size="10">Both implement generate() + close()</text>

      <!-- Tool calling box -->
      <rect x="15" y="140" width="260" height="82" rx="6" fill="#f3e8ff" stroke="#c4b5fd" stroke-width="1"/>
      <text x="145" y="158" text-anchor="middle" fill="#5b21b6" font-size="11" font-weight="600">Chat Service Tool Calling</text>
      <text x="145" y="176" text-anchor="middle" fill="#6b7280" font-size="10">generate_pipeline(repo_url)</text>
      <text x="145" y="190" text-anchor="middle" fill="#6b7280" font-size="10">commit_pipeline(repo_url)</text>
      <text x="145" y="204" text-anchor="middle" fill="#6b7280" font-size="10">check_status | validate | connectivity</text>
    </g>

    <!-- Arrow from gateway to routers -->
    <line x1="262" y1="72" x2="298" y2="72" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowBlue)"/>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION: Backend to AI Layer                               -->
  <!-- ============================================================ -->
  <line x1="900" y1="683" x2="900" y2="715" stroke="#7c3aed" stroke-width="2.5" marker-end="url(#arrowPurple)"/>
  <text x="920" y="704" fill="#7c3aed" font-size="10" font-weight="500">LLM Calls</text>

  <!-- ============================================================ -->
  <!-- SECTION 4: AI / LLM LAYER                                    -->
  <!-- ============================================================ -->
  <g transform="translate(0, 720)">
    <rect x="20" y="0" width="1760" height="200" rx="12" fill="url(#sectionBg2)" stroke="#d8b4fe" stroke-width="1.5" filter="url(#shadowSm)"/>
    <rect x="20" y="0" width="180" height="30" rx="8" fill="url(#purpleGrad)"/>
    <text x="110" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">AI / LLM LAYER</text>

    <!-- Ollama Provider -->
    <g transform="translate(150, 45)">
      <rect width="380" height="140" rx="10" fill="#fff" stroke="#7c3aed" stroke-width="2" filter="url(#shadow)"/>
      <rect width="380" height="32" rx="10" fill="url(#purpleGrad)"/>
      <rect x="0" y="22" width="380" height="10" fill="url(#purpleGrad)"/>
      <text x="28" y="22" fill="#fff" font-size="16">&#x1F9E0;</text>
      <text x="190" y="22" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">Ollama LLM Server</text>
      <text x="350" y="22" fill="#e9d5ff" font-size="11">:11434</text>

      <text x="30" y="56" fill="#374151" font-size="12" font-weight="600">Model: qwen3:32b</text>
      <text x="30" y="76" fill="#6b7280" font-size="11">Custom: pipeline-generator-v5</text>
      <text x="30" y="96" fill="#6b7280" font-size="11">Temperature: 0.2 (deterministic)</text>
      <text x="30" y="116" fill="#6b7280" font-size="11">Capabilities: Tool/Function calling, Streaming</text>
      <text x="30" y="133" fill="#9333ea" font-size="10" font-weight="600">Chat Service uses Ollama for tool calling</text>
    </g>

    <!-- OR divider -->
    <g transform="translate(580, 100)">
      <circle cx="25" cy="15" r="22" fill="#7c3aed" filter="url(#shadowSm)"/>
      <text x="25" y="20" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">OR</text>
    </g>

    <!-- Claude Code Provider -->
    <g transform="translate(670, 45)">
      <rect width="380" height="140" rx="10" fill="#fff" stroke="#6d28d9" stroke-width="2" filter="url(#shadow)"/>
      <rect width="380" height="32" rx="10" fill="#6d28d9"/>
      <rect x="0" y="22" width="380" height="10" fill="#6d28d9"/>
      <text x="28" y="22" fill="#fff" font-size="16">&#x2728;</text>
      <text x="190" y="22" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">Claude Code CLI</text>
      <text x="340" y="22" fill="#e9d5ff" font-size="11">subprocess</text>

      <text x="30" y="56" fill="#374151" font-size="12" font-weight="600">Models: Sonnet / Opus</text>
      <text x="30" y="76" fill="#6b7280" font-size="11">Integration: subprocess-based CLI</text>
      <text x="30" y="96" fill="#6b7280" font-size="11">Auth: ~/.claude mount (writable)</text>
      <text x="30" y="116" fill="#6b7280" font-size="11">Output: JSON {"type":"result","result":"..."}</text>
      <text x="30" y="133" fill="#6d28d9" font-size="10" font-weight="600">Pipeline generation only (no tool calling)</text>
    </g>

    <!-- Factory arrows -->
    <g transform="translate(1100, 45)">
      <rect width="280" height="140" rx="10" fill="#f5f3ff" stroke="#a78bfa" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="140" y="24" text-anchor="middle" fill="#5b21b6" font-size="13" font-weight="700">Factory Pattern</text>
      <line x1="140" y1="32" x2="140" y2="32" stroke="#c4b5fd" stroke-width="1"/>
      <text x="140" y="52" text-anchor="middle" fill="#6b7280" font-size="11">LLM_PROVIDER=ollama</text>
      <text x="140" y="68" text-anchor="middle" fill="#6b7280" font-size="10">  --> OllamaIntegration()</text>
      <text x="140" y="90" text-anchor="middle" fill="#6b7280" font-size="11">LLM_PROVIDER=claude-code</text>
      <text x="140" y="106" text-anchor="middle" fill="#6b7280" font-size="10">  --> ClaudeCodeIntegration()</text>
      <text x="140" y="130" text-anchor="middle" fill="#9333ea" font-size="10" font-weight="500">app/integrations/llm_provider.py</text>
    </g>

    <!-- Connecting arrows from factory to providers -->
    <line x1="1100" y1="90" x2="1052" y2="90" stroke="#7c3aed" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowPurple)"/>
    <line x1="1100" y1="140" x2="1052" y2="140" stroke="#6d28d9" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowPurple)"/>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION: AI Layer to Tools                                 -->
  <!-- ============================================================ -->
  <line x1="900" y1="922" x2="900" y2="955" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>
  <text x="920" y="944" fill="#6b7280" font-size="10" font-weight="500">API Calls</text>

  <!-- ============================================================ -->
  <!-- SECTION 5: CORE TOOLS GRID                                    -->
  <!-- ============================================================ -->
  <g transform="translate(0, 960)">
    <rect x="20" y="0" width="1760" height="440" rx="12" fill="#fff" stroke="#d1d5db" stroke-width="1.5" filter="url(#shadowLg)"/>
    <rect x="20" y="0" width="330" height="30" rx="8" fill="#374151"/>
    <text x="185" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">CORE TOOLS GRID (13 Integrations)</text>

    <!-- ROW 1: Source Code and CI/CD (Blue) -->
    <text x="60" y="58" fill="#1e40af" font-size="13" font-weight="700">Source Code &amp; CI/CD</text>
    <rect x="58" y="62" width="150" height="2" fill="#2563eb"/>

    <!-- GitLab -->
    <g transform="translate(60, 72)">
      <rect width="260" height="100" rx="8" fill="#fff" stroke="#2563eb" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#blueGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#blueGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F98A;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">GitLab Server</text>
      <text x="235" y="19" fill="#bfdbfe" font-size="10">:8929</text>
      <text x="20" y="46" fill="#374151" font-size="11">Version Control (Git)</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">CI/CD Pipeline Execution</text>
      <text x="20" y="78" fill="#6b7280" font-size="10">Pipeline Status &amp; Monitoring</text>
      <text x="20" y="92" fill="#2563eb" font-size="10" font-weight="500">gitlab-server (Docker DNS)</text>
    </g>

    <!-- Gitea / GitHub -->
    <g transform="translate(345, 72)">
      <rect width="260" height="100" rx="8" fill="#fff" stroke="#2563eb" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#blueGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#blueGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F419;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Gitea (GitHub)</text>
      <text x="235" y="19" fill="#bfdbfe" font-size="10">:3000</text>
      <text x="20" y="46" fill="#374151" font-size="11">GitHub Actions Alternative</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Self-hosted VCS</text>
      <text x="20" y="78" fill="#6b7280" font-size="10">Workflow Generation</text>
      <text x="20" y="92" fill="#2563eb" font-size="10" font-weight="500">gitea-server (Docker DNS)</text>
    </g>

    <!-- Jenkins -->
    <g transform="translate(630, 72)">
      <rect width="260" height="100" rx="8" fill="#fff" stroke="#2563eb" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#blueGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#blueGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F477;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Jenkins</text>
      <text x="235" y="19" fill="#bfdbfe" font-size="10">:8080</text>
      <text x="20" y="46" fill="#374151" font-size="11">Alternative CI/CD</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Pipeline Orchestration</text>
      <text x="20" y="78" fill="#6b7280" font-size="10">Job Execution Engine</text>
      <text x="20" y="92" fill="#2563eb" font-size="10" font-weight="500">jenkins-master (Docker DNS)</text>
    </g>

    <!-- ROW 2: Security and Quality -->
    <text x="60" y="198" fill="#b91c1c" font-size="13" font-weight="700">Security &amp; Quality</text>
    <rect x="58" y="202" width="150" height="2" fill="#dc2626"/>

    <!-- SonarQube -->
    <g transform="translate(60, 212)">
      <rect width="260" height="100" rx="8" fill="#fff" stroke="#16a34a" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#greenGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#greenGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F50D;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">SonarQube</text>
      <text x="235" y="19" fill="#bbf7d0" font-size="10">:9000</text>
      <text x="20" y="46" fill="#374151" font-size="11">Code Quality Analysis</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Quality Gates &amp; Rules</text>
      <text x="20" y="78" fill="#6b7280" font-size="10">Issue Tracking / Metrics</text>
      <text x="20" y="92" fill="#16a34a" font-size="10" font-weight="500">ai-sonarqube (Docker DNS)</text>
    </g>

    <!-- Trivy -->
    <g transform="translate(345, 212)">
      <rect width="260" height="100" rx="8" fill="#fff" stroke="#dc2626" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#redGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#redGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F6E1;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Trivy</text>
      <text x="235" y="19" fill="#fecaca" font-size="10">:8080</text>
      <text x="20" y="46" fill="#374151" font-size="11">Container Scanning</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Vulnerability Detection</text>
      <text x="20" y="78" fill="#6b7280" font-size="10">Image Security Analysis</text>
      <text x="20" y="92" fill="#dc2626" font-size="10" font-weight="500">trivy-server (Docker DNS)</text>
    </g>

    <!-- SAST -->
    <g transform="translate(630, 212)">
      <rect width="260" height="100" rx="8" fill="#fff" stroke="#ea580c" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="#ea580c"/>
      <rect x="0" y="18" width="260" height="8" fill="#ea580c"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F512;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">SAST</text>
      <text x="20" y="46" fill="#374151" font-size="11">Static Application Security</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Source Code Analysis</text>
      <text x="20" y="78" fill="#6b7280" font-size="10">Pattern-Based Detection</text>
      <text x="20" y="92" fill="#ea580c" font-size="10" font-weight="500">Integrated in CI pipeline stage</text>
    </g>

    <!-- ROW 3: Storage and Registry (right column area) -->
    <text x="940" y="58" fill="#0e7490" font-size="13" font-weight="700">Storage &amp; Registry</text>
    <rect x="938" y="62" width="140" height="2" fill="#0891b2"/>

    <!-- Nexus -->
    <g transform="translate(940, 72)">
      <rect width="240" height="100" rx="8" fill="#fff" stroke="#059669" stroke-width="2" filter="url(#shadow)"/>
      <rect width="240" height="26" rx="8" fill="url(#emeraldGrad)"/>
      <rect x="0" y="18" width="240" height="8" fill="url(#emeraldGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F4E6;</text>
      <text x="120" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Nexus</text>
      <text x="195" y="19" fill="#a7f3d0" font-size="9">:5001/:8081</text>
      <text x="15" y="46" fill="#374151" font-size="11">Docker Registry</text>
      <text x="15" y="62" fill="#6b7280" font-size="10">Artifact Management</text>
      <text x="15" y="78" fill="#6b7280" font-size="10">Image Storage &amp; Pull</text>
      <text x="15" y="92" fill="#059669" font-size="10" font-weight="500">ai-nexus (Docker DNS)</text>
    </g>

    <!-- ChromaDB -->
    <g transform="translate(1210, 72)">
      <rect width="240" height="100" rx="8" fill="#fff" stroke="#0891b2" stroke-width="2" filter="url(#shadow)"/>
      <rect width="240" height="26" rx="8" fill="url(#tealGrad)"/>
      <rect x="0" y="18" width="240" height="8" fill="url(#tealGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F4A0;</text>
      <text x="120" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">ChromaDB</text>
      <text x="210" y="19" fill="#a5f3fc" font-size="10">:8000</text>
      <text x="15" y="46" fill="#374151" font-size="11">Vector Database (RAG)</text>
      <text x="15" y="62" fill="#6b7280" font-size="10">Pipeline Templates</text>
      <text x="15" y="78" fill="#6b7280" font-size="10">RL Feedback Storage</text>
      <text x="15" y="92" fill="#0891b2" font-size="10" font-weight="500">Semantic Search</text>
    </g>

    <!-- PostgreSQL -->
    <g transform="translate(940, 212)">
      <rect width="240" height="100" rx="8" fill="#fff" stroke="#0891b2" stroke-width="2" filter="url(#shadow)"/>
      <rect width="240" height="26" rx="8" fill="url(#tealGrad)"/>
      <rect x="0" y="18" width="240" height="8" fill="url(#tealGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F5C4;</text>
      <text x="120" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">PostgreSQL</text>
      <text x="210" y="19" fill="#a5f3fc" font-size="10">:5432</text>
      <text x="15" y="46" fill="#374151" font-size="11">Relational Database</text>
      <text x="15" y="62" fill="#6b7280" font-size="10">Conversations &amp; Sessions</text>
      <text x="15" y="78" fill="#6b7280" font-size="10">Pipeline History</text>
      <text x="15" y="92" fill="#0891b2" font-size="10" font-weight="500">ai-postgres (Docker DNS)</text>
    </g>

    <!-- Redis -->
    <g transform="translate(1210, 212)">
      <rect width="240" height="100" rx="8" fill="#fff" stroke="#d97706" stroke-width="2" filter="url(#shadow)"/>
      <rect width="240" height="26" rx="8" fill="url(#amberGrad)"/>
      <rect x="0" y="18" width="240" height="8" fill="url(#amberGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x26A1;</text>
      <text x="120" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Redis</text>
      <text x="210" y="19" fill="#fde68a" font-size="10">:6379</text>
      <text x="15" y="46" fill="#374151" font-size="11">In-Memory Cache</text>
      <text x="15" y="62" fill="#6b7280" font-size="10">Session Caching</text>
      <text x="15" y="78" fill="#6b7280" font-size="10">Rate Limiting</text>
      <text x="15" y="92" fill="#d97706" font-size="10" font-weight="500">redis (Docker DNS)</text>
    </g>

    <!-- ROW 4: Monitoring and Collaboration -->
    <text x="60" y="340" fill="#b45309" font-size="13" font-weight="700">Monitoring &amp; Collaboration</text>
    <rect x="58" y="344" width="200" height="2" fill="#d97706"/>

    <!-- Splunk -->
    <g transform="translate(60, 354)">
      <rect width="260" height="72" rx="8" fill="#fff" stroke="#d97706" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#amberGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#amberGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F4CA;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Splunk</text>
      <text x="230" y="19" fill="#fde68a" font-size="10">:8088</text>
      <text x="20" y="46" fill="#374151" font-size="11">Event Logging (HEC)</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Pipeline Notifications &amp; Metrics</text>
    </g>

    <!-- Jira -->
    <g transform="translate(345, 354)">
      <rect width="260" height="72" rx="8" fill="#fff" stroke="#2563eb" stroke-width="2" filter="url(#shadow)"/>
      <rect width="260" height="26" rx="8" fill="url(#blueGrad)"/>
      <rect x="0" y="18" width="260" height="8" fill="url(#blueGrad)"/>
      <text x="16" y="18" fill="#fff" font-size="13">&#x1F4CB;</text>
      <text x="130" y="19" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Jira</text>
      <text x="230" y="19" fill="#bfdbfe" font-size="10">:8080</text>
      <text x="20" y="46" fill="#374151" font-size="11">Issue Tracking</text>
      <text x="20" y="62" fill="#6b7280" font-size="10">Access Requests / Project: DEVOPS</text>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION: Tools to Pipeline Flow                            -->
  <!-- ============================================================ -->
  <line x1="900" y1="1402" x2="900" y2="1435" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>

  <!-- ============================================================ -->
  <!-- SECTION 6: PIPELINE GENERATION FLOW                           -->
  <!-- ============================================================ -->
  <g transform="translate(0, 1440)">
    <rect x="20" y="0" width="1760" height="210" rx="12" fill="url(#sectionBg3)" stroke="#86efac" stroke-width="1.5" filter="url(#shadowSm)"/>
    <rect x="20" y="0" width="340" height="30" rx="8" fill="url(#greenGrad)"/>
    <text x="190" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">PIPELINE GENERATION FLOW (Key Use Case)</text>

    <!-- Step boxes - Row 1 -->
    <g transform="translate(50, 45)">
      <!-- Step 1 -->
      <g transform="translate(0, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#16a34a" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#16a34a"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">1</text>
        <text x="42" y="18" fill="#166534" font-size="11" font-weight="600">User sends</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">Repository URL</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">(via Chat or API)</text>
      </g>
      <line x1="172" y1="31" x2="188" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 2 -->
      <g transform="translate(190, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#16a34a" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#16a34a"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">2</text>
        <text x="42" y="18" fill="#166534" font-size="11" font-weight="600">Analyze Repo</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">Language, Framework</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">Build tools detection</text>
      </g>
      <line x1="362" y1="31" x2="378" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 3 -->
      <g transform="translate(380, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#0891b2" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#0891b2"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">3</text>
        <text x="42" y="18" fill="#0e7490" font-size="11" font-weight="600">Query ChromaDB</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">RAG template search</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">Semantic matching</text>
      </g>
      <line x1="552" y1="31" x2="568" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 4 -->
      <g transform="translate(570, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#7c3aed" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#7c3aed"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">4</text>
        <text x="42" y="18" fill="#5b21b6" font-size="11" font-weight="600">Generate Files</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">Dockerfile</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">.gitlab-ci.yml</text>
      </g>
      <line x1="742" y1="31" x2="758" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 5 -->
      <g transform="translate(760, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#d97706" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#d97706"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">5</text>
        <text x="42" y="18" fill="#92400e" font-size="11" font-weight="600">Validate</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">Dry-run check</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">Syntax + structure</text>
      </g>
    </g>

    <!-- Step boxes - Row 2 -->
    <g transform="translate(50, 125)">
      <!-- Step 6 -->
      <g transform="translate(0, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#4f46e5" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#4f46e5"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">6</text>
        <text x="42" y="18" fill="#3730a3" font-size="11" font-weight="600">User Approves</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">Preview &amp; confirm</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">Chat approval flow</text>
      </g>
      <line x1="172" y1="31" x2="188" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 7 -->
      <g transform="translate(190, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#2563eb" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#2563eb"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">7</text>
        <text x="42" y="18" fill="#1e40af" font-size="11" font-weight="600">Commit to GitLab</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">New branch push</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">ai-pipeline-* branch</text>
      </g>
      <line x1="362" y1="31" x2="378" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 8 -->
      <g transform="translate(380, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#2563eb" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#2563eb"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">8</text>
        <text x="42" y="18" fill="#1e40af" font-size="11" font-weight="600">Trigger Pipeline</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">GitLab CI runs</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">Auto-triggered on push</text>
      </g>
      <line x1="552" y1="31" x2="568" y2="31" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

      <!-- Step 9 -->
      <g transform="translate(570, 0)">
        <rect width="170" height="62" rx="8" fill="#fff" stroke="#059669" stroke-width="1.5" filter="url(#shadowSm)"/>
        <circle cx="18" cy="14" r="12" fill="#059669"/>
        <text x="18" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="700">9</text>
        <text x="42" y="18" fill="#065f46" font-size="11" font-weight="600">Monitor</text>
        <text x="42" y="34" fill="#6b7280" font-size="10">Execution tracking</text>
        <text x="42" y="50" fill="#6b7280" font-size="9">Status â†’ RL feedback</text>
      </g>
    </g>

    <!-- Arrow connecting row 1 to row 2 -->
    <path d="M 983 107 Q 1000 107, 1000 140 Q 1000 152, 980 155 L 50 155 L 50 158" stroke="#16a34a" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrowGreen)"/>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION                                                    -->
  <!-- ============================================================ -->
  <line x1="900" y1="1653" x2="900" y2="1688" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>

  <!-- ============================================================ -->
  <!-- SECTION 7: 9-STAGE PIPELINE                                   -->
  <!-- ============================================================ -->
  <g transform="translate(0, 1693)">
    <rect x="20" y="0" width="1760" height="230" rx="12" fill="#fff" stroke="#93c5fd" stroke-width="1.5" filter="url(#shadowLg)"/>
    <rect x="20" y="0" width="360" height="30" rx="8" fill="url(#blueGrad)"/>
    <text x="200" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">9-STAGE CI/CD PIPELINE (.gitlab-ci.yml)</text>

    <!-- Pipeline stages as connected chain -->
    <!-- Stage 1: compile -->
    <g transform="translate(45, 48)">
      <rect width="155" height="50" rx="8" fill="#dbeafe" stroke="#2563eb" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#1e40af" font-size="13" font-weight="700">compile</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Maven/Python/Go</text>
    </g>
    <line x1="202" y1="73" x2="218" y2="73" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowBlue)"/>

    <!-- Stage 2: build -->
    <g transform="translate(220, 48)">
      <rect width="155" height="50" rx="8" fill="#dbeafe" stroke="#2563eb" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#1e40af" font-size="13" font-weight="700">build</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Kaniko + Nexus</text>
    </g>
    <line x1="377" y1="73" x2="393" y2="73" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowBlue)"/>

    <!-- Stage 3: test -->
    <g transform="translate(395, 48)">
      <rect width="155" height="50" rx="8" fill="#dbeafe" stroke="#2563eb" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#1e40af" font-size="13" font-weight="700">test</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Image verify</text>
    </g>
    <line x1="552" y1="73" x2="568" y2="73" stroke="#dc2626" stroke-width="2" marker-end="url(#arrowRed)"/>

    <!-- Stage 4: sast -->
    <g transform="translate(570, 48)">
      <rect width="155" height="50" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#991b1b" font-size="13" font-weight="700">sast</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Security scan</text>
    </g>
    <line x1="727" y1="73" x2="743" y2="73" stroke="#16a34a" stroke-width="2" marker-end="url(#arrowGreen)"/>

    <!-- Stage 5: quality -->
    <g transform="translate(745, 48)">
      <rect width="155" height="50" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#166534" font-size="13" font-weight="700">quality</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">SonarQube</text>
    </g>
    <line x1="902" y1="73" x2="918" y2="73" stroke="#dc2626" stroke-width="2" marker-end="url(#arrowRed)"/>

    <!-- Stage 6: security -->
    <g transform="translate(920, 48)">
      <rect width="155" height="50" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#991b1b" font-size="13" font-weight="700">security</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Trivy</text>
    </g>
    <line x1="1077" y1="73" x2="1093" y2="73" stroke="#059669" stroke-width="2" marker-end="url(#arrowGreen)"/>

    <!-- Stage 7: push -->
    <g transform="translate(1095, 48)">
      <rect width="155" height="50" rx="8" fill="#d1fae5" stroke="#059669" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#065f46" font-size="13" font-weight="700">push</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Nexus registry</text>
    </g>
    <line x1="1252" y1="73" x2="1268" y2="73" stroke="#d97706" stroke-width="2" marker-end="url(#arrowAmber)"/>

    <!-- Stage 8: notify -->
    <g transform="translate(1270, 48)">
      <rect width="155" height="50" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#92400e" font-size="13" font-weight="700">notify</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">Splunk</text>
    </g>
    <line x1="1427" y1="73" x2="1443" y2="73" stroke="#0891b2" stroke-width="2" marker-end="url(#arrowTeal)"/>

    <!-- Stage 9: learn -->
    <g transform="translate(1445, 48)">
      <rect width="155" height="50" rx="8" fill="#ccfbf1" stroke="#0891b2" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="78" y="22" text-anchor="middle" fill="#0e7490" font-size="13" font-weight="700">learn</text>
      <text x="78" y="40" text-anchor="middle" fill="#6b7280" font-size="9">ChromaDB (RL)</text>
    </g>

    <!-- Tool icons row below stages -->
    <g transform="translate(45, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#6b7280" font-size="22">&#x1F4BB;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">Compiler</text>
    </g>
    <g transform="translate(220, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#6b7280" font-size="22">&#x1F3D7;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">Kaniko</text>
    </g>
    <g transform="translate(395, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#6b7280" font-size="22">&#x1F9EA;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">Verify</text>
    </g>
    <g transform="translate(570, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#dc2626" font-size="22">&#x1F512;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">SAST</text>
    </g>
    <g transform="translate(745, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#16a34a" font-size="22">&#x1F50D;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">SonarQube</text>
    </g>
    <g transform="translate(920, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#dc2626" font-size="22">&#x1F6E1;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">Trivy</text>
    </g>
    <g transform="translate(1095, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#059669" font-size="22">&#x1F4E6;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">Nexus</text>
    </g>
    <g transform="translate(1270, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#d97706" font-size="22">&#x1F4CA;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">Splunk</text>
    </g>
    <g transform="translate(1445, 120)">
      <text x="78" y="14" text-anchor="middle" fill="#0891b2" font-size="22">&#x1F4A0;</text>
      <text x="78" y="35" text-anchor="middle" fill="#9ca3af" font-size="9">ChromaDB</text>
    </g>

    <!-- Stage flow label -->
    <text x="900" y="200" text-anchor="middle" fill="#6b7280" font-size="12" font-style="italic">Each stage gate-checks the previous -- failure triggers Self-Healing loop (see below)</text>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION                                                    -->
  <!-- ============================================================ -->
  <line x1="900" y1="1925" x2="900" y2="1958" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>

  <!-- ============================================================ -->
  <!-- SECTION 8: REINFORCEMENT LEARNING LOOP                        -->
  <!-- ============================================================ -->
  <g transform="translate(0, 1963)">
    <rect x="20" y="0" width="1760" height="310" rx="12" fill="url(#sectionBg2)" stroke="#d8b4fe" stroke-width="1.5" filter="url(#shadowLg)"/>
    <rect x="20" y="0" width="360" height="30" rx="8" fill="url(#purpleGrad)"/>
    <text x="200" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">REINFORCEMENT LEARNING LOOP</text>

    <!-- Central circular flow -->
    <!-- Generate Pipeline -->
    <g transform="translate(80, 60)">
      <rect width="220" height="65" rx="10" fill="#fff" stroke="#7c3aed" stroke-width="2.5" filter="url(#shadow)"/>
      <text x="110" y="26" text-anchor="middle" fill="#5b21b6" font-size="14" font-weight="700">Generate Pipeline</text>
      <text x="110" y="48" text-anchor="middle" fill="#6b7280" font-size="11">LLM + RAG Templates</text>
    </g>
    <line x1="302" y1="92" x2="360" y2="92" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowPurple)"/>

    <!-- Execute in GitLab -->
    <g transform="translate(362, 60)">
      <rect width="220" height="65" rx="10" fill="#fff" stroke="#2563eb" stroke-width="2.5" filter="url(#shadow)"/>
      <text x="110" y="26" text-anchor="middle" fill="#1e40af" font-size="14" font-weight="700">Execute in GitLab</text>
      <text x="110" y="48" text-anchor="middle" fill="#6b7280" font-size="11">Run 9-stage CI/CD</text>
    </g>
    <line x1="584" y1="92" x2="642" y2="92" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowBlue)"/>

    <!-- Monitor Results -->
    <g transform="translate(644, 60)">
      <rect width="220" height="65" rx="10" fill="#fff" stroke="#d97706" stroke-width="2.5" filter="url(#shadow)"/>
      <text x="110" y="26" text-anchor="middle" fill="#92400e" font-size="14" font-weight="700">Monitor Results</text>
      <text x="110" y="48" text-anchor="middle" fill="#6b7280" font-size="11">Check stage outcomes</text>
    </g>

    <!-- Decision diamond -->
    <g transform="translate(930, 60)">
      <polygon points="75,0 150,40 75,80 0,40" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#shadowSm)"/>
      <text x="75" y="36" text-anchor="middle" fill="#92400e" font-size="13" font-weight="700">Pass?</text>
      <text x="75" y="52" text-anchor="middle" fill="#b45309" font-size="10">All stages</text>
    </g>
    <line x1="866" y1="92" x2="932" y2="100" stroke="#d97706" stroke-width="2" marker-end="url(#arrowAmber)"/>

    <!-- SUCCESS PATH (Green) -->
    <!-- Arrow from diamond going right (success) -->
    <line x1="1082" y1="100" x2="1140" y2="100" stroke="#16a34a" stroke-width="2.5" marker-end="url(#arrowGreen)"/>
    <text x="1092" y="90" fill="#16a34a" font-size="12" font-weight="700">YES</text>

    <!-- Store in ChromaDB -->
    <g transform="translate(1142, 70)">
      <rect width="230" height="60" rx="10" fill="#d1fae5" stroke="#059669" stroke-width="2" filter="url(#shadow)"/>
      <text x="115" y="24" text-anchor="middle" fill="#065f46" font-size="13" font-weight="700">Store in ChromaDB</text>
      <text x="115" y="44" text-anchor="middle" fill="#6b7280" font-size="10">Successful template + metadata</text>
    </g>
    <line x1="1372" y1="100" x2="1410" y2="100" stroke="#059669" stroke-width="2" marker-end="url(#arrowGreen)"/>

    <!-- Future RAG Retrieval -->
    <g transform="translate(1412, 70)">
      <rect width="230" height="60" rx="10" fill="#ccfbf1" stroke="#0891b2" stroke-width="2" filter="url(#shadow)"/>
      <text x="115" y="24" text-anchor="middle" fill="#0e7490" font-size="13" font-weight="700">Future RAG Retrieval</text>
      <text x="115" y="44" text-anchor="middle" fill="#6b7280" font-size="10">Better generation next time</text>
    </g>

    <!-- Feedback arrow from Future RAG back to Generate -->
    <path d="M 1527 132 L 1527 170 Q 1527 180, 1517 180 L 200 180 Q 190 180, 190 170 L 190 127" stroke="#059669" stroke-width="2" fill="none" stroke-dasharray="8,4" marker-end="url(#arrowGreen)"/>
    <text x="860" y="195" text-anchor="middle" fill="#059669" font-size="11" font-weight="600">Improved Templates Feed Back Into Generation</text>

    <!-- FAILURE PATH (Red) -->
    <!-- Arrow from diamond going down (failure) -->
    <line x1="1005" y1="142" x2="1005" y2="170" stroke="#dc2626" stroke-width="2.5" marker-end="url(#arrowRed)"/>
    <text x="1028" y="158" fill="#dc2626" font-size="12" font-weight="700">NO</text>

    <!-- Self-Healing box -->
    <g transform="translate(100, 215)">
      <rect width="220" height="60" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2" filter="url(#shadow)"/>
      <text x="110" y="24" text-anchor="middle" fill="#991b1b" font-size="13" font-weight="700">Self-Healing</text>
      <text x="110" y="44" text-anchor="middle" fill="#6b7280" font-size="10">Detect failure cause</text>
    </g>

    <!-- LLM Fix -->
    <g transform="translate(380, 215)">
      <rect width="220" height="60" rx="10" fill="#f3e8ff" stroke="#7c3aed" stroke-width="2" filter="url(#shadow)"/>
      <text x="110" y="24" text-anchor="middle" fill="#5b21b6" font-size="13" font-weight="700">LLM Fix</text>
      <text x="110" y="44" text-anchor="middle" fill="#6b7280" font-size="10">AI generates corrected pipeline</text>
    </g>

    <!-- Retry -->
    <g transform="translate(660, 215)">
      <rect width="220" height="60" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#shadow)"/>
      <text x="110" y="24" text-anchor="middle" fill="#92400e" font-size="13" font-weight="700">Retry (max 3x)</text>
      <text x="110" y="44" text-anchor="middle" fill="#6b7280" font-size="10">Re-commit &amp; re-execute</text>
    </g>

    <!-- Failure path arrows -->
    <path d="M 1005 172 Q 1005 195, 990 195 L 322 245" stroke="#dc2626" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
    <line x1="322" y1="245" x2="378" y2="245" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowPurple)"/>
    <line x1="602" y1="245" x2="658" y2="245" stroke="#d97706" stroke-width="2" marker-end="url(#arrowAmber)"/>

    <!-- Arrow from Retry back to Execute -->
    <path d="M 770 213 L 770 190 Q 770 175, 760 175 L 520 175 Q 510 175, 510 165 L 490 127" stroke="#2563eb" stroke-width="2" fill="none" stroke-dasharray="5,3" marker-end="url(#arrowBlue)"/>
    <text x="640" y="171" fill="#2563eb" font-size="10" font-weight="500">Back to Execute</text>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION                                                    -->
  <!-- ============================================================ -->
  <line x1="900" y1="2276" x2="900" y2="2308" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>

  <!-- ============================================================ -->
  <!-- SECTION 9: CONNECTIVITY AND ACCESS FLOW                       -->
  <!-- ============================================================ -->
  <g transform="translate(0, 2313)">
    <rect x="20" y="0" width="1760" height="170" rx="12" fill="url(#sectionBg1)" stroke="#93c5fd" stroke-width="1.5" filter="url(#shadowSm)"/>
    <rect x="20" y="0" width="330" height="30" rx="8" fill="url(#blueGrad)"/>
    <text x="185" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">CONNECTIVITY &amp; ACCESS FLOW</text>

    <!-- Flow boxes -->
    <g transform="translate(60, 55)">
      <!-- User checks -->
      <rect width="220" height="60" rx="8" fill="#fff" stroke="#4f46e5" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="110" y="24" text-anchor="middle" fill="#3730a3" font-size="12" font-weight="700">User Checks Health</text>
      <text x="110" y="44" text-anchor="middle" fill="#6b7280" font-size="10">/api/v1/connectivity/check-all</text>
    </g>
    <line x1="282" y1="85" x2="320" y2="85" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowGray)"/>

    <g transform="translate(322, 55)">
      <rect width="220" height="60" rx="8" fill="#fff" stroke="#2563eb" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="110" y="24" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="700">Parallel Health Checks</text>
      <text x="110" y="44" text-anchor="middle" fill="#6b7280" font-size="10">All 13 tools checked</text>
    </g>
    <line x1="544" y1="85" x2="582" y2="85" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowGray)"/>

    <g transform="translate(584, 55)">
      <rect width="220" height="60" rx="8" fill="#fff" stroke="#16a34a" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="110" y="24" text-anchor="middle" fill="#166534" font-size="12" font-weight="700">Status Grid</text>
      <text x="110" y="44" text-anchor="middle" fill="#6b7280" font-size="10">Connected / Failed / Unknown</text>
    </g>
    <line x1="806" y1="85" x2="844" y2="85" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowGray)"/>

    <!-- Decision -->
    <g transform="translate(846, 55)">
      <polygon points="50,0 100,30 50,60 0,30" fill="#fef3c7" stroke="#d97706" stroke-width="1.5"/>
      <text x="50" y="34" text-anchor="middle" fill="#92400e" font-size="11" font-weight="700">Failed?</text>
    </g>

    <!-- Yes path -->
    <line x1="948" y1="85" x2="988" y2="85" stroke="#dc2626" stroke-width="2" marker-end="url(#arrowRed)"/>
    <text x="960" y="78" fill="#dc2626" font-size="10" font-weight="600">YES</text>

    <g transform="translate(990, 55)">
      <rect width="260" height="60" rx="8" fill="#fff" stroke="#2563eb" stroke-width="1.5" filter="url(#shadowSm)"/>
      <text x="130" y="24" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="700">Jira Access Request</text>
      <text x="130" y="44" text-anchor="middle" fill="#6b7280" font-size="10">Auto-create ticket in DEVOPS project</text>
    </g>

    <!-- No path label -->
    <text x="896" y="130" text-anchor="middle" fill="#16a34a" font-size="10" font-weight="600">NO = All healthy</text>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION                                                    -->
  <!-- ============================================================ -->
  <line x1="900" y1="2486" x2="900" y2="2518" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>

  <!-- ============================================================ -->
  <!-- SECTION 10: DOCKER NETWORKING                                 -->
  <!-- ============================================================ -->
  <g transform="translate(0, 2523)">
    <rect x="20" y="0" width="1760" height="210" rx="12" fill="#fff" stroke="#d1d5db" stroke-width="1.5" filter="url(#shadowLg)"/>
    <rect x="20" y="0" width="280" height="30" rx="8" fill="#374151"/>
    <text x="160" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">DOCKER NETWORKING</text>

    <!-- ai-platform-net -->
    <g transform="translate(60, 45)">
      <rect width="760" height="145" rx="10" fill="#eff6ff" stroke="#2563eb" stroke-width="2" stroke-dasharray="8,4" filter="url(#shadowSm)"/>
      <text x="380" y="24" text-anchor="middle" fill="#1e40af" font-size="15" font-weight="700">ai-platform-net (external: true)</text>
      <text x="380" y="44" text-anchor="middle" fill="#6b7280" font-size="11">Primary Docker network connecting all AI platform services</text>

      <!-- Service pills in network -->
      <g transform="translate(20, 58)">
        <rect x="0" y="0" width="95" height="24" rx="6" fill="#2563eb"/>
        <text x="47" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Backend</text>
        <rect x="105" y="0" width="95" height="24" rx="6" fill="#0891b2"/>
        <text x="152" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">ChromaDB</text>
        <rect x="210" y="0" width="95" height="24" rx="6" fill="#0891b2"/>
        <text x="257" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">PostgreSQL</text>
        <rect x="315" y="0" width="68" height="24" rx="6" fill="#d97706"/>
        <text x="349" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Redis</text>
        <rect x="393" y="0" width="78" height="24" rx="6" fill="#7c3aed"/>
        <text x="432" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Ollama</text>
        <rect x="481" y="0" width="88" height="24" rx="6" fill="#16a34a"/>
        <text x="525" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">SonarQube</text>
        <rect x="579" y="0" width="68" height="24" rx="6" fill="#dc2626"/>
        <text x="613" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Trivy</text>
        <rect x="657" y="0" width="68" height="24" rx="6" fill="#059669"/>
        <text x="691" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Nexus</text>
      </g>
      <g transform="translate(20, 92)">
        <rect x="0" y="0" width="78" height="24" rx="6" fill="#d97706"/>
        <text x="39" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Splunk</text>
        <rect x="88" y="0" width="68" height="24" rx="6" fill="#2563eb"/>
        <text x="122" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Jira</text>
        <rect x="166" y="0" width="85" height="24" rx="6" fill="#2563eb"/>
        <text x="208" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Jenkins</text>
        <rect x="261" y="0" width="68" height="24" rx="6" fill="#2563eb"/>
        <text x="295" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="600">Gitea</text>
      </g>
    </g>

    <!-- gitlab-net -->
    <g transform="translate(880, 45)">
      <rect width="500" height="145" rx="10" fill="#fef2f2" stroke="#dc2626" stroke-width="2" stroke-dasharray="8,4" filter="url(#shadowSm)"/>
      <text x="250" y="24" text-anchor="middle" fill="#991b1b" font-size="15" font-weight="700">gitlab-net (external: true)</text>
      <text x="250" y="44" text-anchor="middle" fill="#6b7280" font-size="11">External network for GitLab server access</text>

      <g transform="translate(20, 58)">
        <rect x="0" y="0" width="120" height="28" rx="6" fill="#dc2626"/>
        <text x="60" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">GitLab Server</text>
        <rect x="135" y="0" width="120" height="28" rx="6" fill="#2563eb"/>
        <text x="195" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Backend</text>
      </g>

      <text x="250" y="112" text-anchor="middle" fill="#991b1b" font-size="11" font-weight="500">gitlab-server DNS resolves only</text>
      <text x="250" y="128" text-anchor="middle" fill="#991b1b" font-size="11" font-weight="500">inside Docker containers</text>
    </g>

    <!-- Bridging arrow between networks -->
    <line x1="422" y1="135" x2="878" y2="135" stroke="#6b7280" stroke-width="1.5" stroke-dasharray="5,3"/>
    <text x="650" y="130" text-anchor="middle" fill="#6b7280" font-size="10">Backend bridges both networks</text>
  </g>

  <!-- ============================================================ -->
  <!-- CONNECTION                                                    -->
  <!-- ============================================================ -->
  <line x1="900" y1="2735" x2="900" y2="2768" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrowGray)"/>

  <!-- ============================================================ -->
  <!-- SECTION 11: AUTHENTICATION TABLE                              -->
  <!-- ============================================================ -->
  <g transform="translate(0, 2773)">
    <rect x="20" y="0" width="1760" height="235" rx="12" fill="#fff" stroke="#d1d5db" stroke-width="1.5" filter="url(#shadowLg)"/>
    <rect x="20" y="0" width="300" height="30" rx="8" fill="#374151"/>
    <text x="170" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">AUTHENTICATION REFERENCE</text>

    <!-- Table headers -->
    <g transform="translate(60, 45)">
      <rect width="1680" height="32" rx="6" fill="#f1f5f9"/>
      <text x="120" y="22" text-anchor="middle" fill="#374151" font-size="12" font-weight="700">Auth Type</text>
      <text x="560" y="22" text-anchor="middle" fill="#374151" font-size="12" font-weight="700">Services</text>
      <text x="1200" y="22" text-anchor="middle" fill="#374151" font-size="12" font-weight="700">Configuration</text>
    </g>

    <!-- Row 1: Token -->
    <g transform="translate(60, 82)">
      <rect width="1680" height="28" rx="4" fill="#fff" stroke="#e5e7eb" stroke-width="0.5"/>
      <rect x="40" y="4" width="72" height="20" rx="4" fill="#dbeafe"/>
      <text x="76" y="18" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="600">Token</text>
      <text x="560" y="19" text-anchor="middle" fill="#374151" font-size="11">GitLab (GITLAB_TOKEN), GitHub (GITHUB_TOKEN), SonarQube (Password)</text>
      <text x="1200" y="19" text-anchor="middle" fill="#6b7280" font-size="10">Environment variables, private-token header</text>
    </g>

    <!-- Row 2: Basic -->
    <g transform="translate(60, 114)">
      <rect width="1680" height="28" rx="4" fill="#f9fafb" stroke="#e5e7eb" stroke-width="0.5"/>
      <rect x="40" y="4" width="72" height="20" rx="4" fill="#fef3c7"/>
      <text x="76" y="18" text-anchor="middle" fill="#92400e" font-size="11" font-weight="600">Basic</text>
      <text x="560" y="19" text-anchor="middle" fill="#374151" font-size="11">Nexus (admin/password), Jenkins (user/password), Jira (user/api_token)</text>
      <text x="1200" y="19" text-anchor="middle" fill="#6b7280" font-size="10">HTTP Basic Authentication, Base64 encoded</text>
    </g>

    <!-- Row 3: HEC -->
    <g transform="translate(60, 146)">
      <rect width="1680" height="28" rx="4" fill="#fff" stroke="#e5e7eb" stroke-width="0.5"/>
      <rect x="40" y="4" width="72" height="20" rx="4" fill="#fef3c7"/>
      <text x="76" y="18" text-anchor="middle" fill="#92400e" font-size="11" font-weight="600">HEC</text>
      <text x="560" y="19" text-anchor="middle" fill="#374151" font-size="11">Splunk (SPLUNK_TOKEN via HTTPS :8088)</text>
      <text x="1200" y="19" text-anchor="middle" fill="#6b7280" font-size="10">HTTP Event Collector, Authorization: Splunk &lt;token&gt;</text>
    </g>

    <!-- Row 4: None -->
    <g transform="translate(60, 178)">
      <rect width="1680" height="28" rx="4" fill="#f9fafb" stroke="#e5e7eb" stroke-width="0.5"/>
      <rect x="40" y="4" width="72" height="20" rx="4" fill="#dcfce7"/>
      <text x="76" y="18" text-anchor="middle" fill="#166534" font-size="11" font-weight="600">None</text>
      <text x="560" y="19" text-anchor="middle" fill="#374151" font-size="11">ChromaDB, Ollama, Trivy (open access within Docker network)</text>
      <text x="1200" y="19" text-anchor="middle" fill="#6b7280" font-size="10">No authentication required, network-level security only</text>
    </g>

    <!-- Row 5: Env/Mount -->
    <g transform="translate(60, 210)">
      <rect width="1680" height="20" rx="4" fill="#fff" stroke="#e5e7eb" stroke-width="0.5"/>
      <rect x="40" y="0" width="100" height="20" rx="4" fill="#f3e8ff"/>
      <text x="90" y="14" text-anchor="middle" fill="#5b21b6" font-size="11" font-weight="600">Env/Mount</text>
      <text x="560" y="14" text-anchor="middle" fill="#374151" font-size="11">Claude Code CLI (~/.claude mount, writable)</text>
      <text x="1200" y="14" text-anchor="middle" fill="#6b7280" font-size="10">Docker volume mount: C:/Users/deepak/.claude:/root/.claude</text>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- LEGEND (bottom-right)                                         -->
  <!-- ============================================================ -->
  <g transform="translate(0, 3040)">
    <rect x="20" y="0" width="1760" height="130" rx="12" fill="#fff" stroke="#d1d5db" stroke-width="1.5" filter="url(#shadowSm)"/>
    <rect x="20" y="0" width="140" height="30" rx="8" fill="#374151"/>
    <text x="90" y="20" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">LEGEND</text>

    <!-- Color legend row 1 -->
    <g transform="translate(60, 45)">
      <rect x="0" y="0" width="16" height="16" rx="3" fill="#7c3aed"/>
      <text x="24" y="13" fill="#374151" font-size="11">AI / LLM Components</text>

      <rect x="190" y="0" width="16" height="16" rx="3" fill="#2563eb"/>
      <text x="214" y="13" fill="#374151" font-size="11">CI/CD Tools</text>

      <rect x="340" y="0" width="16" height="16" rx="3" fill="#dc2626"/>
      <text x="364" y="13" fill="#374151" font-size="11">Security Tools</text>

      <rect x="500" y="0" width="16" height="16" rx="3" fill="#16a34a"/>
      <text x="524" y="13" fill="#374151" font-size="11">Quality Tools</text>

      <rect x="660" y="0" width="16" height="16" rx="3" fill="#0891b2"/>
      <text x="684" y="13" fill="#374151" font-size="11">Storage / DB</text>

      <rect x="810" y="0" width="16" height="16" rx="3" fill="#d97706"/>
      <text x="834" y="13" fill="#374151" font-size="11">Monitoring</text>

      <rect x="960" y="0" width="16" height="16" rx="3" fill="#4f46e5"/>
      <text x="984" y="13" fill="#374151" font-size="11">Frontend / User</text>

      <rect x="1130" y="0" width="16" height="16" rx="3" fill="#059669"/>
      <text x="1154" y="13" fill="#374151" font-size="11">Registry / Artifacts</text>
    </g>

    <!-- Line styles -->
    <g transform="translate(60, 78)">
      <line x1="0" y1="8" x2="50" y2="8" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowGray)"/>
      <text x="62" y="13" fill="#374151" font-size="11">Synchronous call</text>

      <line x1="220" y1="8" x2="270" y2="8" stroke="#6b7280" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowGray)"/>
      <text x="282" y="13" fill="#374151" font-size="11">Async / Optional</text>

      <rect x="450" y="0" width="56" height="16" rx="3" fill="#dbeafe" stroke="#2563eb" stroke-width="1"/>
      <text x="520" y="13" fill="#374151" font-size="11">Active component</text>

      <rect x="670" y="0" width="56" height="16" rx="3" fill="#fff" stroke="#d1d5db" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="740" y="13" fill="#374151" font-size="11">External / Future</text>

      <polygon points="910,0 926,8 910,16 894,8" fill="#fef3c7" stroke="#d97706" stroke-width="1"/>
      <text x="940" y="13" fill="#374151" font-size="11">Decision point</text>

      <circle cx="1100" cy="8" r="8" fill="#16a34a"/>
      <text x="1100" y="12" text-anchor="middle" fill="#fff" font-size="8" font-weight="700">N</text>
      <text x="1120" y="13" fill="#374151" font-size="11">Step number</text>
    </g>

    <!-- Footer -->
    <text x="1700" y="118" text-anchor="end" fill="#9ca3af" font-size="10">AI DevOps Platform Architecture v1.0 | Generated 2026-02-08</text>
  </g>

</svg>
