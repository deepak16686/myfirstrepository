<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 750" font-family="Arial, sans-serif">
  <!-- Background -->
  <rect width="1000" height="750" fill="#f8fafc"/>

  <!-- Title -->
  <text x="500" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#1e293b">Reinforcement Learning Loop: How the System Learns</text>
  <text x="500" y="55" text-anchor="middle" font-size="14" fill="#64748b">Template-based Learning with Success/Failure Feedback</text>

  <!-- Central Circle - The Loop -->
  <circle cx="500" cy="400" r="280" fill="none" stroke="#e2e8f0" stroke-width="4" stroke-dasharray="15,10"/>

  <!-- Step 1: New Request (Top) -->
  <g transform="translate(500, 120)">
    <rect x="-100" y="-40" width="200" height="80" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
    <text x="0" y="-10" text-anchor="middle" font-size="16" font-weight="bold" fill="#1e40af">1. NEW REQUEST</text>
    <text x="0" y="10" text-anchor="middle" font-size="12" fill="#3b82f6">"Create Go pipeline"</text>
    <text x="0" y="25" text-anchor="middle" font-size="11" fill="#64748b">User submits repo URL</text>
  </g>

  <!-- Arrow 1→2 -->
  <path d="M 560 160 Q 680 200 720 280" fill="none" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrow-blue)"/>
  <text x="670" y="220" font-size="12" fill="#3b82f6" font-weight="bold">Check DB</text>

  <!-- Step 2: Query ChromaDB (Right) -->
  <g transform="translate(800, 350)">
    <rect x="-120" y="-50" width="180" height="100" rx="10" fill="#f3e8ff" stroke="#9333ea" stroke-width="3"/>
    <text x="-30" y="-25" text-anchor="middle" font-size="15" font-weight="bold" fill="#7c3aed">2. QUERY</text>
    <text x="-30" y="-5" text-anchor="middle" font-size="12" fill="#9333ea">ChromaDB</text>
    <text x="-30" y="15" text-anchor="middle" font-size="11" fill="#64748b">"Any successful</text>
    <text x="-30" y="30" text-anchor="middle" font-size="11" fill="#64748b">Go templates?"</text>
  </g>

  <!-- Arrow 2→3 -->
  <path d="M 720 420 Q 680 500 580 560" fill="none" stroke="#9333ea" stroke-width="3" marker-end="url(#arrow-purple)"/>
  <text x="680" y="500" font-size="12" fill="#9333ea" font-weight="bold">Use or Generate</text>

  <!-- Step 3: Generate Pipeline (Bottom) -->
  <g transform="translate(500, 620)">
    <rect x="-130" y="-50" width="260" height="100" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
    <text x="0" y="-25" text-anchor="middle" font-size="15" font-weight="bold" fill="#b45309">3. GENERATE</text>
    <text x="0" y="0" text-anchor="middle" font-size="12" fill="#d97706">Create .gitlab-ci.yml</text>
    <text x="-50" y="25" text-anchor="middle" font-size="10" fill="#16a34a">✓ From template</text>
    <text x="60" y="25" text-anchor="middle" font-size="10" fill="#dc2626">✗ Via LLM</text>
  </g>

  <!-- Arrow 3→4 -->
  <path d="M 420 560 Q 320 500 280 420" fill="none" stroke="#f59e0b" stroke-width="3" marker-end="url(#arrow-orange)"/>
  <text x="320" y="500" font-size="12" fill="#f59e0b" font-weight="bold">Execute</text>

  <!-- Step 4: Run Pipeline (Left) -->
  <g transform="translate(200, 350)">
    <rect x="-120" y="-50" width="180" height="100" rx="10" fill="#e0e7ff" stroke="#6366f1" stroke-width="3"/>
    <text x="-30" y="-25" text-anchor="middle" font-size="15" font-weight="bold" fill="#4338ca">4. EXECUTE</text>
    <text x="-30" y="-5" text-anchor="middle" font-size="12" fill="#6366f1">GitLab Pipeline</text>
    <text x="-30" y="15" text-anchor="middle" font-size="11" fill="#64748b">9 stages run</text>
    <text x="-30" y="30" text-anchor="middle" font-size="11" fill="#64748b">in CI/CD</text>
  </g>

  <!-- Arrow 4→5 (splits into two) -->
  <path d="M 280 280 Q 320 200 420 160" fill="none" stroke="#6366f1" stroke-width="3" marker-end="url(#arrow-indigo)"/>
  <text x="320" y="200" font-size="12" fill="#6366f1" font-weight="bold">Result</text>

  <!-- Step 5: Feedback (back at top, split) -->
  <!-- Success Path -->
  <g transform="translate(350, 200)">
    <rect x="-70" y="-35" width="140" height="70" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
    <text x="0" y="-10" text-anchor="middle" font-size="13" font-weight="bold" fill="#166534">✅ SUCCESS</text>
    <text x="0" y="10" text-anchor="middle" font-size="11" fill="#15803d">Store in ChromaDB</text>
    <text x="0" y="25" text-anchor="middle" font-size="10" fill="#64748b">+1 success count</text>
  </g>

  <!-- Failure Path -->
  <g transform="translate(650, 200)">
    <rect x="-70" y="-35" width="140" height="70" rx="8" fill="#fecaca" stroke="#dc2626" stroke-width="2"/>
    <text x="0" y="-10" text-anchor="middle" font-size="13" font-weight="bold" fill="#991b1b">❌ FAILURE</text>
    <text x="0" y="10" text-anchor="middle" font-size="11" fill="#b91c1c">Don't store</text>
    <text x="0" y="25" text-anchor="middle" font-size="10" fill="#64748b">Log for analysis</text>
  </g>

  <!-- Central Label -->
  <circle cx="500" cy="400" r="60" fill="#1e293b"/>
  <text x="500" y="395" text-anchor="middle" font-size="14" font-weight="bold" fill="white">RL</text>
  <text x="500" y="415" text-anchor="middle" font-size="14" font-weight="bold" fill="white">LOOP</text>

  <!-- Bottom Explanation -->
  <rect x="50" y="690" width="900" height="50" rx="8" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="500" y="715" text-anchor="middle" font-size="13" fill="#334155">
    <tspan font-weight="bold">Key Insight:</tspan> Success → Template stored → Future requests use stored template → Consistent results
  </text>
  <text x="500" y="732" text-anchor="middle" font-size="12" fill="#64748b">After first success, Go projects achieve ~100% success rate (no LLM variability)</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9333ea"/>
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
    </marker>
    <marker id="arrow-indigo" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6366f1"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
  </defs>
</svg>
