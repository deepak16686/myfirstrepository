<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1300" width="1600" height="1300">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f97316"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1600" height="1300" fill="#f8fafc"/>

  <!-- Title -->
  <rect x="0" y="0" width="1600" height="60" fill="#1e293b"/>
  <text x="800" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="white">Open-WebUI Architecture - How Prompts, Documents &amp; Models are Stored</text>

  <!-- ==================== OPEN-WEBUI CONTAINER ==================== -->
  <rect x="20" y="80" width="1560" height="600" rx="15" fill="#eff6ff" stroke="#3b82f6" stroke-width="3"/>
  <rect x="20" y="80" width="1560" height="45" rx="15" fill="#3b82f6"/>
  <text x="800" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white">OPEN-WEBUI CONTAINER (localhost:3001)</text>

  <!-- Frontend Layer -->
  <rect x="50" y="145" width="700" height="180" rx="10" fill="white" stroke="#6366f1" stroke-width="2"/>
  <rect x="50" y="145" width="700" height="30" rx="10" fill="#6366f1"/>
  <text x="400" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">FRONTEND (SvelteKit / TypeScript)</text>

  <!-- Frontend Components -->
  <rect x="70" y="190" width="150" height="60" rx="6" fill="#c7d2fe" stroke="#6366f1" stroke-width="1"/>
  <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#4338ca">Chat Interface</text>
  <text x="145" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#6366f1">Message Input/Output</text>

  <rect x="240" y="190" width="150" height="60" rx="6" fill="#c7d2fe" stroke="#6366f1" stroke-width="1"/>
  <text x="315" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#4338ca">Model Selector</text>
  <text x="315" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#6366f1">Choose AI Model</text>

  <rect x="410" y="190" width="150" height="60" rx="6" fill="#c7d2fe" stroke="#6366f1" stroke-width="1"/>
  <text x="485" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#4338ca">Admin Panel</text>
  <text x="485" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#6366f1">Manage Models/Tools</text>

  <rect x="580" y="190" width="150" height="60" rx="6" fill="#c7d2fe" stroke="#6366f1" stroke-width="1"/>
  <text x="655" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#4338ca">Document Upload</text>
  <text x="655" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#6366f1">Files &amp; Knowledge</text>

  <!-- Feature boxes -->
  <rect x="70" y="265" width="320" height="45" rx="4" fill="#e0e7ff"/>
  <text x="230" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4338ca">Features: File Upload, Web Search, Code Interpreter</text>
  <text x="230" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4338ca">Vision, Citations, Image Generation</text>

  <rect x="410" y="265" width="320" height="45" rx="4" fill="#e0e7ff"/>
  <text x="570" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4338ca">Admin: Create Models, Import/Export</text>
  <text x="570" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4338ca">Attach Tools, Set System Prompts</text>

  <!-- Backend Layer -->
  <rect x="780" y="145" width="770" height="180" rx="10" fill="white" stroke="#22c55e" stroke-width="2"/>
  <rect x="780" y="145" width="770" height="30" rx="10" fill="#22c55e"/>
  <text x="1165" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">BACKEND API (FastAPI / Python)</text>

  <!-- Backend Routes -->
  <rect x="800" y="190" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="870" y="212" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/models</text>
  <text x="870" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">CRUD Operations</text>

  <rect x="960" y="190" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="1030" y="212" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/tools</text>
  <text x="1030" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">Tool Management</text>

  <rect x="1120" y="190" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="1190" y="212" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/prompts</text>
  <text x="1190" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">Prompt Templates</text>

  <rect x="1280" y="190" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="1350" y="212" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/chats</text>
  <text x="1350" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">Chat History</text>

  <rect x="800" y="255" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="870" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/files</text>
  <text x="870" y="293" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">File Upload</text>

  <rect x="960" y="255" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="1030" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/knowledge</text>
  <text x="1030" y="293" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">Knowledge Base</text>

  <rect x="1120" y="255" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="1190" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/api/v1/documents</text>
  <text x="1190" y="293" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">RAG Documents</text>

  <rect x="1280" y="255" width="140" height="55" rx="6" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <text x="1350" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">/ollama/*</text>
  <text x="1350" y="293" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">LLM Proxy</text>

  <!-- Database Layer -->
  <rect x="50" y="350" width="1500" height="310" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
  <rect x="50" y="350" width="1500" height="30" rx="10" fill="#8b5cf6"/>
  <text x="800" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">DATA STORAGE LAYER (/app/backend/data/)</text>

  <!-- SQLite Database -->
  <rect x="70" y="400" width="900" height="240" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <rect x="70" y="400" width="900" height="28" rx="8" fill="#f59e0b"/>
  <text x="520" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">SQLite Database (webui.db) - 30 Tables</text>

  <!-- Model Table -->
  <rect x="90" y="440" width="200" height="90" rx="5" fill="#fed7aa" stroke="#f97316" stroke-width="1"/>
  <text x="190" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#c2410c">model</text>
  <text x="100" y="480" font-family="monospace" font-size="8" fill="#7c2d12">id, name, base_model_id</text>
  <text x="100" y="493" font-family="monospace" font-size="8" fill="#7c2d12">meta (JSON): toolIds,</text>
  <text x="100" y="506" font-family="monospace" font-size="8" fill="#7c2d12">  capabilities, description</text>
  <text x="100" y="519" font-family="monospace" font-size="8" fill="#7c2d12">params (JSON): system prompt</text>

  <!-- Tool Table -->
  <rect x="310" y="440" width="200" height="90" rx="5" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="410" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#166534">tool</text>
  <text x="320" y="480" font-family="monospace" font-size="8" fill="#14532d">id, name, user_id</text>
  <text x="320" y="493" font-family="monospace" font-size="8" fill="#14532d">content: Python code</text>
  <text x="320" y="506" font-family="monospace" font-size="8" fill="#14532d">specs: Tool schema</text>
  <text x="320" y="519" font-family="monospace" font-size="8" fill="#14532d">valves: Configuration</text>

  <!-- Prompt Table -->
  <rect x="530" y="440" width="200" height="90" rx="5" fill="#e9d5ff" stroke="#8b5cf6" stroke-width="1"/>
  <text x="630" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6b21a8">prompt</text>
  <text x="540" y="480" font-family="monospace" font-size="8" fill="#581c87">id, command, user_id</text>
  <text x="540" y="493" font-family="monospace" font-size="8" fill="#581c87">title: Display name</text>
  <text x="540" y="506" font-family="monospace" font-size="8" fill="#581c87">content: Prompt text</text>
  <text x="540" y="519" font-family="monospace" font-size="8" fill="#581c87">access_control: JSON</text>

  <!-- Chat Table -->
  <rect x="750" y="440" width="200" height="90" rx="5" fill="#cffafe" stroke="#06b6d4" stroke-width="1"/>
  <text x="850" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0e7490">chat</text>
  <text x="760" y="480" font-family="monospace" font-size="8" fill="#164e63">id, user_id, title</text>
  <text x="760" y="493" font-family="monospace" font-size="8" fill="#164e63">chat (JSON): messages</text>
  <text x="760" y="506" font-family="monospace" font-size="8" fill="#164e63">meta, folder_id</text>
  <text x="760" y="519" font-family="monospace" font-size="8" fill="#164e63">share_id, pinned</text>

  <!-- Document Table -->
  <rect x="90" y="545" width="200" height="80" rx="5" fill="#fecaca" stroke="#ef4444" stroke-width="1"/>
  <text x="190" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#991b1b">document</text>
  <text x="100" y="585" font-family="monospace" font-size="8" fill="#7f1d1d">collection_name, name</text>
  <text x="100" y="598" font-family="monospace" font-size="8" fill="#7f1d1d">title, filename, content</text>
  <text x="100" y="611" font-family="monospace" font-size="8" fill="#7f1d1d">user_id, timestamp</text>

  <!-- Knowledge Table -->
  <rect x="310" y="545" width="200" height="80" rx="5" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
  <text x="410" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">knowledge</text>
  <text x="320" y="585" font-family="monospace" font-size="8" fill="#1e3a8a">id, name, description</text>
  <text x="320" y="598" font-family="monospace" font-size="8" fill="#1e3a8a">data (JSON): file refs</text>
  <text x="320" y="611" font-family="monospace" font-size="8" fill="#1e3a8a">access_control</text>

  <!-- File Table -->
  <rect x="530" y="545" width="200" height="80" rx="5" fill="#fce7f3" stroke="#ec4899" stroke-width="1"/>
  <text x="630" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#9d174d">file</text>
  <text x="540" y="585" font-family="monospace" font-size="8" fill="#831843">id, filename, path</text>
  <text x="540" y="598" font-family="monospace" font-size="8" fill="#831843">meta, hash, data</text>
  <text x="540" y="611" font-family="monospace" font-size="8" fill="#831843">access_control</text>

  <!-- User Table -->
  <rect x="750" y="545" width="200" height="80" rx="5" fill="#f5f5f4" stroke="#78716c" stroke-width="1"/>
  <text x="850" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#44403c">user</text>
  <text x="760" y="585" font-family="monospace" font-size="8" fill="#57534e">id, name, email, role</text>
  <text x="760" y="598" font-family="monospace" font-size="8" fill="#57534e">settings (JSON)</text>
  <text x="760" y="611" font-family="monospace" font-size="8" fill="#57534e">profile_image_url</text>

  <!-- File Storage -->
  <rect x="1000" y="400" width="230" height="120" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
  <text x="1115" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">File Storage</text>
  <text x="1010" y="450" font-family="Arial, sans-serif" font-size="10" fill="#15803d">/uploads/</text>
  <text x="1020" y="467" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">User uploaded files</text>
  <text x="1010" y="490" font-family="Arial, sans-serif" font-size="10" fill="#15803d">/cache/</text>
  <text x="1020" y="507" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">Model &amp; response cache</text>

  <!-- Vector DB -->
  <rect x="1260" y="400" width="270" height="120" rx="8" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2"/>
  <text x="1395" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#6b21a8">Vector Database</text>
  <text x="1270" y="450" font-family="Arial, sans-serif" font-size="10" fill="#7c3aed">/vector_db/</text>
  <text x="1280" y="467" font-family="Arial, sans-serif" font-size="9" fill="#8b5cf6">ChromaDB collections</text>
  <text x="1280" y="484" font-family="Arial, sans-serif" font-size="9" fill="#8b5cf6">Document embeddings</text>
  <text x="1280" y="501" font-family="Arial, sans-serif" font-size="9" fill="#8b5cf6">Used for RAG retrieval</text>

  <!-- Relationships -->
  <rect x="1000" y="535" width="530" height="95" rx="8" fill="#fef2f2" stroke="#ef4444" stroke-width="2"/>
  <text x="1265" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#991b1b">KEY RELATIONSHIPS</text>
  <text x="1010" y="575" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">• model.meta.toolIds[] → links to tool.id (array of tool IDs)</text>
  <text x="1010" y="590" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">• model.params.system → stores the system prompt for that model</text>
  <text x="1010" y="605" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">• knowledge_file.knowledge_id → links files to knowledge bases</text>
  <text x="1010" y="620" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">• chat.chat (JSON) → contains all messages with model responses</text>

  <!-- ==================== EXTERNAL CONNECTIONS ==================== -->
  <rect x="20" y="700" width="1560" height="140" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <rect x="20" y="700" width="1560" height="30" rx="10" fill="#f59e0b"/>
  <text x="800" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">EXTERNAL CONNECTIONS</text>

  <!-- Ollama -->
  <rect x="50" y="745" width="280" height="80" rx="8" fill="#1e293b" stroke="#0f172a" stroke-width="2"/>
  <text x="190" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Ollama LLM Server</text>
  <text x="190" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#94a3b8">localhost:11434</text>
  <text x="190" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#64748b">qwen2.5-coder, deepseek-coder, llama3</text>

  <!-- DevOps Backend -->
  <rect x="370" y="745" width="280" height="80" rx="8" fill="#bbf7d0" stroke="#22c55e" stroke-width="2"/>
  <text x="510" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">DevOps Backend</text>
  <text x="510" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#22c55e">localhost:8003</text>
  <text x="510" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#15803d">Called via Tools (Python code)</text>

  <!-- GitLab -->
  <rect x="690" y="745" width="280" height="80" rx="8" fill="#fed7aa" stroke="#f97316" stroke-width="2"/>
  <text x="830" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2410c">GitLab Server</text>
  <text x="830" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#ea580c">localhost:8929</text>
  <text x="830" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#f97316">Called via Tool: gitlab_pipeline_generator</text>

  <!-- Nexus -->
  <rect x="1010" y="745" width="280" height="80" rx="8" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
  <text x="1150" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4338ca">Nexus Repository</text>
  <text x="1150" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6366f1">localhost:8081</text>
  <text x="1150" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#818cf8">Called via Tool: nexus_docker_images</text>

  <!-- SonarQube -->
  <rect x="1330" y="745" width="230" height="80" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
  <text x="1445" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">SonarQube</text>
  <text x="1445" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#22c55e">localhost:9002</text>
  <text x="1445" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#15803d">Called via Tool: project_validator</text>

  <!-- ==================== HOW MODEL + TOOLS + PROMPTS WORK ==================== -->
  <rect x="20" y="860" width="1560" height="420" rx="10" fill="white" stroke="#1e293b" stroke-width="2"/>
  <rect x="20" y="860" width="1560" height="35" rx="10" fill="#1e293b"/>
  <text x="800" y="883" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">HOW MODEL SELECTION PROVIDES PROMPTS, TOOLS &amp; DOCUMENTS TO LLM</text>

  <!-- Step 1 -->
  <rect x="50" y="910" width="220" height="100" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="160" y="930" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af">1. User Selects Model</text>
  <text x="60" y="955" font-family="Arial, sans-serif" font-size="9" fill="#1e3a8a">User picks from dropdown:</text>
  <text x="60" y="970" font-family="Arial, sans-serif" font-size="9" fill="#3b82f6">• "Gitlab Pipeline Generator"</text>
  <text x="60" y="985" font-family="Arial, sans-serif" font-size="9" fill="#3b82f6">• "Project Validator"</text>
  <text x="60" y="1000" font-family="Arial, sans-serif" font-size="9" fill="#3b82f6">• "Nexus-D"</text>

  <line x1="270" y1="960" x2="310" y2="960" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 2 -->
  <rect x="320" y="910" width="280" height="100" rx="8" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2"/>
  <text x="460" y="930" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#6b21a8">2. Load Model Config from DB</text>
  <text x="330" y="955" font-family="monospace" font-size="8" fill="#5b21b6">SELECT * FROM model WHERE id='model-id'</text>
  <text x="330" y="975" font-family="Arial, sans-serif" font-size="9" fill="#7c3aed">Returns:</text>
  <text x="330" y="990" font-family="Arial, sans-serif" font-size="9" fill="#7c3aed">• base_model_id (which Ollama model)</text>
  <text x="330" y="1003" font-family="Arial, sans-serif" font-size="9" fill="#7c3aed">• meta.toolIds[] (attached tools)</text>

  <line x1="600" y1="960" x2="640" y2="960" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 3 -->
  <rect x="650" y="910" width="280" height="100" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
  <text x="790" y="930" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">3. Load Tools by IDs</text>
  <text x="660" y="955" font-family="monospace" font-size="8" fill="#14532d">SELECT * FROM tool WHERE id IN (...)</text>
  <text x="660" y="975" font-family="Arial, sans-serif" font-size="9" fill="#15803d">For each toolId in meta.toolIds:</text>
  <text x="660" y="990" font-family="Arial, sans-serif" font-size="9" fill="#15803d">• Load Python code (content)</text>
  <text x="660" y="1003" font-family="Arial, sans-serif" font-size="9" fill="#15803d">• Load tool specs (OpenAI schema)</text>

  <line x1="930" y1="960" x2="970" y2="960" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 4 -->
  <rect x="980" y="910" width="280" height="100" rx="8" fill="#fed7aa" stroke="#f97316" stroke-width="2"/>
  <text x="1120" y="930" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2410c">4. Build LLM Request</text>
  <text x="990" y="955" font-family="Arial, sans-serif" font-size="9" fill="#7c2d12">Combine into API call to Ollama:</text>
  <text x="990" y="970" font-family="Arial, sans-serif" font-size="9" fill="#ea580c">• system: model.params.system</text>
  <text x="990" y="985" font-family="Arial, sans-serif" font-size="9" fill="#ea580c">• tools: [tool.specs for each tool]</text>
  <text x="990" y="1000" font-family="Arial, sans-serif" font-size="9" fill="#ea580c">• messages: user conversation</text>

  <line x1="1260" y1="960" x2="1300" y2="960" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 5 -->
  <rect x="1310" y="910" width="250" height="100" rx="8" fill="#1e293b" stroke="#0f172a" stroke-width="2"/>
  <text x="1435" y="930" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">5. Send to Ollama</text>
  <text x="1320" y="955" font-family="Arial, sans-serif" font-size="9" fill="#94a3b8">POST /api/chat</text>
  <text x="1320" y="970" font-family="Arial, sans-serif" font-size="9" fill="#cbd5e1">LLM receives:</text>
  <text x="1320" y="985" font-family="Arial, sans-serif" font-size="9" fill="#cbd5e1">• System prompt</text>
  <text x="1320" y="1000" font-family="Arial, sans-serif" font-size="9" fill="#cbd5e1">• Tool definitions</text>

  <!-- Tool Execution Flow -->
  <rect x="50" y="1030" width="1510" height="230" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="805" y="1055" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#92400e">TOOL EXECUTION FLOW (When LLM decides to call a tool)</text>

  <!-- Tool call steps -->
  <rect x="70" y="1075" width="200" height="80" rx="6" fill="#fff7ed"/>
  <text x="170" y="1095" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">6. LLM Response</text>
  <text x="80" y="1115" font-family="Arial, sans-serif" font-size="9" fill="#b45309">LLM returns tool_call:</text>
  <text x="80" y="1130" font-family="monospace" font-size="8" fill="#d97706">{"name": "get_pipeline",</text>
  <text x="80" y="1143" font-family="monospace" font-size="8" fill="#d97706"> "args": {...}}</text>

  <line x1="270" y1="1115" x2="310" y2="1115" stroke="#f97316" stroke-width="2" marker-end="url(#arrowOrange)"/>

  <rect x="320" y="1075" width="220" height="80" rx="6" fill="#fff7ed"/>
  <text x="430" y="1095" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">7. Execute Python Code</text>
  <text x="330" y="1115" font-family="Arial, sans-serif" font-size="9" fill="#b45309">Open-WebUI runs tool.content</text>
  <text x="330" y="1130" font-family="Arial, sans-serif" font-size="9" fill="#b45309">Python code with args</text>
  <text x="330" y="1145" font-family="Arial, sans-serif" font-size="9" fill="#b45309">(calls external APIs)</text>

  <line x1="540" y1="1115" x2="580" y2="1115" stroke="#f97316" stroke-width="2" marker-end="url(#arrowOrange)"/>

  <rect x="590" y="1075" width="220" height="80" rx="6" fill="#fff7ed"/>
  <text x="700" y="1095" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">8. Tool Calls DevOps Backend</text>
  <text x="600" y="1115" font-family="Arial, sans-serif" font-size="9" fill="#b45309">HTTP request to:</text>
  <text x="600" y="1130" font-family="Arial, sans-serif" font-size="9" fill="#b45309">localhost:8003/api/v1/...</text>
  <text x="600" y="1145" font-family="Arial, sans-serif" font-size="9" fill="#b45309">or GitLab, Nexus, etc.</text>

  <line x1="810" y1="1115" x2="850" y2="1115" stroke="#f97316" stroke-width="2" marker-end="url(#arrowOrange)"/>

  <rect x="860" y="1075" width="200" height="80" rx="6" fill="#fff7ed"/>
  <text x="960" y="1095" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">9. Return Result</text>
  <text x="870" y="1115" font-family="Arial, sans-serif" font-size="9" fill="#b45309">Tool returns data to</text>
  <text x="870" y="1130" font-family="Arial, sans-serif" font-size="9" fill="#b45309">Open-WebUI backend</text>
  <text x="870" y="1145" font-family="Arial, sans-serif" font-size="9" fill="#b45309">(JSON response)</text>

  <line x1="1060" y1="1115" x2="1100" y2="1115" stroke="#f97316" stroke-width="2" marker-end="url(#arrowOrange)"/>

  <rect x="1110" y="1075" width="200" height="80" rx="6" fill="#fff7ed"/>
  <text x="1210" y="1095" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">10. Send Back to LLM</text>
  <text x="1120" y="1115" font-family="Arial, sans-serif" font-size="9" fill="#b45309">Tool result added to</text>
  <text x="1120" y="1130" font-family="Arial, sans-serif" font-size="9" fill="#b45309">conversation, sent back</text>
  <text x="1120" y="1145" font-family="Arial, sans-serif" font-size="9" fill="#b45309">to Ollama for response</text>

  <line x1="1310" y1="1115" x2="1350" y2="1115" stroke="#f97316" stroke-width="2" marker-end="url(#arrowOrange)"/>

  <rect x="1360" y="1075" width="180" height="80" rx="6" fill="#fff7ed"/>
  <text x="1450" y="1095" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400e">11. Final Response</text>
  <text x="1370" y="1115" font-family="Arial, sans-serif" font-size="9" fill="#b45309">LLM generates final</text>
  <text x="1370" y="1130" font-family="Arial, sans-serif" font-size="9" fill="#b45309">user-friendly response</text>
  <text x="1370" y="1145" font-family="Arial, sans-serif" font-size="9" fill="#b45309">using tool data</text>

  <!-- Summary box -->
  <rect x="70" y="1170" width="1480" height="75" rx="6" fill="#fef2f2" stroke="#ef4444" stroke-width="1"/>
  <text x="810" y="1195" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#991b1b">SUMMARY: When you select a model in Open-WebUI</text>
  <text x="810" y="1215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7f1d1d">1) The model's system prompt (from params.system) is automatically sent to Ollama with every message</text>
  <text x="810" y="1232" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7f1d1d">2) The attached tools (from meta.toolIds) are loaded and their specs sent to Ollama for function calling</text>
</svg>
