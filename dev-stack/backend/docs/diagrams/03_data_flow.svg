<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 700" font-family="Arial, sans-serif">
  <!-- Background -->
  <rect width="1100" height="700" fill="#f8fafc"/>

  <!-- Title -->
  <text x="550" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#1e293b">Data Flow: Pipeline Generation Request</text>

  <!-- Step 1: User Request -->
  <rect x="50" y="70" width="200" height="80" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="150" y="100" text-anchor="middle" font-size="14" font-weight="bold" fill="#1e40af">1. User Request</text>
  <text x="150" y="120" text-anchor="middle" font-size="11" fill="#3b82f6">Chatbot UI</text>
  <text x="150" y="135" text-anchor="middle" font-size="10" fill="#64748b">"Generate pipeline for Go repo"</text>

  <!-- Arrow 1 -->
  <line x1="250" y1="110" x2="320" y2="110" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-blue)"/>

  <!-- Step 2: FastAPI Backend -->
  <rect x="330" y="70" width="200" height="80" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="430" y="100" text-anchor="middle" font-size="14" font-weight="bold" fill="#b45309">2. FastAPI Backend</text>
  <text x="430" y="120" text-anchor="middle" font-size="11" fill="#d97706">:8003/workflow</text>
  <text x="430" y="135" text-anchor="middle" font-size="10" fill="#64748b">Parse request, extract language</text>

  <!-- Arrow 2 -->
  <line x1="530" y1="110" x2="600" y2="110" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrow-orange)"/>

  <!-- Step 3: Priority Check -->
  <rect x="610" y="60" width="200" height="100" rx="10" fill="#f3e8ff" stroke="#9333ea" stroke-width="2"/>
  <text x="710" y="90" text-anchor="middle" font-size="14" font-weight="bold" fill="#7c3aed">3. Priority Check</text>
  <text x="710" y="110" text-anchor="middle" font-size="11" fill="#9333ea">pipeline_generator.py</text>
  <text x="710" y="130" text-anchor="middle" font-size="10" fill="#64748b">Check ChromaDB first</text>
  <text x="710" y="145" text-anchor="middle" font-size="10" fill="#64748b">for proven templates</text>

  <!-- Decision Diamond -->
  <polygon points="710,200 790,260 710,320 630,260" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
  <text x="710" y="255" text-anchor="middle" font-size="12" font-weight="bold" fill="#991b1b">Template</text>
  <text x="710" y="270" text-anchor="middle" font-size="12" font-weight="bold" fill="#991b1b">Found?</text>

  <!-- Arrow to Decision -->
  <line x1="710" y1="160" x2="710" y2="200" stroke="#9333ea" stroke-width="2" marker-end="url(#arrow-purple)"/>

  <!-- YES Path - Left -->
  <text x="600" y="250" font-size="12" font-weight="bold" fill="#16a34a">YES</text>
  <line x1="630" y1="260" x2="500" y2="260" stroke="#16a34a" stroke-width="3" marker-end="url(#arrow-green)"/>

  <!-- ChromaDB Direct Box -->
  <rect x="280" y="220" width="220" height="80" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
  <text x="390" y="250" text-anchor="middle" font-size="14" font-weight="bold" fill="#166534">ChromaDB Direct</text>
  <text x="390" y="270" text-anchor="middle" font-size="11" fill="#15803d">Use proven template</text>
  <text x="390" y="285" text-anchor="middle" font-size="10" fill="#64748b">No LLM needed!</text>

  <!-- NO Path - Right -->
  <text x="820" y="250" font-size="12" font-weight="bold" fill="#dc2626">NO</text>
  <line x1="790" y1="260" x2="920" y2="260" stroke="#dc2626" stroke-width="3" marker-end="url(#arrow-red)"/>

  <!-- Ollama LLM Box -->
  <rect x="930" y="220" width="150" height="80" rx="10" fill="#fecaca" stroke="#dc2626" stroke-width="2"/>
  <text x="1005" y="250" text-anchor="middle" font-size="14" font-weight="bold" fill="#991b1b">Ollama LLM</text>
  <text x="1005" y="270" text-anchor="middle" font-size="11" fill="#b91c1c">Generate new pipeline</text>
  <text x="1005" y="285" text-anchor="middle" font-size="10" fill="#64748b">Slower, less reliable</text>

  <!-- Both paths merge -->
  <line x1="390" y1="300" x2="390" y2="370" stroke="#16a34a" stroke-width="2"/>
  <line x1="1005" y1="300" x2="1005" y2="350" stroke="#dc2626" stroke-width="2"/>
  <line x1="390" y1="370" x2="700" y2="370" stroke="#64748b" stroke-width="2"/>
  <line x1="1005" y1="350" x2="1005" y2="370" stroke="#64748b" stroke-width="2"/>
  <line x1="700" y1="370" x2="1005" y2="370" stroke="#64748b" stroke-width="2"/>
  <line x1="700" y1="370" x2="700" y2="400" stroke="#64748b" stroke-width="2" marker-end="url(#arrow-gray)"/>

  <!-- Step 4: Pipeline Files Generated -->
  <rect x="550" y="410" width="300" height="70" rx="10" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
  <text x="700" y="440" text-anchor="middle" font-size="14" font-weight="bold" fill="#4338ca">4. Pipeline Files Generated</text>
  <text x="700" y="460" text-anchor="middle" font-size="11" fill="#6366f1">.gitlab-ci.yml + Dockerfiles</text>

  <!-- Arrow to GitLab -->
  <line x1="700" y1="480" x2="700" y2="520" stroke="#6366f1" stroke-width="2" marker-end="url(#arrow-indigo)"/>

  <!-- Step 5: Push to GitLab -->
  <rect x="550" y="530" width="300" height="70" rx="10" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
  <text x="700" y="560" text-anchor="middle" font-size="14" font-weight="bold" fill="#be185d">5. Push to GitLab</text>
  <text x="700" y="580" text-anchor="middle" font-size="11" fill="#ec4899">Commit files via GitLab API</text>

  <!-- Arrow to Pipeline -->
  <line x1="700" y1="600" x2="700" y2="630" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-pink)"/>

  <!-- Step 6: Pipeline Runs -->
  <rect x="480" y="640" width="440" height="50" rx="25" fill="#1e293b"/>
  <text x="700" y="672" text-anchor="middle" font-size="14" font-weight="bold" fill="white">6. Pipeline Executes (9 stages) -> Feedback Loop</text>

  <!-- Legend -->
  <rect x="30" y="400" width="220" height="150" rx="8" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="140" y="425" text-anchor="middle" font-size="13" font-weight="bold" fill="#334155">Legend</text>
  <rect x="50" y="440" width="20" height="15" fill="#dcfce7" stroke="#16a34a"/>
  <text x="80" y="452" font-size="11" fill="#334155">RL-Direct (Fast)</text>
  <rect x="50" y="465" width="20" height="15" fill="#fecaca" stroke="#dc2626"/>
  <text x="80" y="477" font-size="11" fill="#334155">LLM Fallback (Slow)</text>
  <rect x="50" y="490" width="20" height="15" fill="#f3e8ff" stroke="#9333ea"/>
  <text x="80" y="502" font-size="11" fill="#334155">Decision Point</text>
  <rect x="50" y="515" width="20" height="15" fill="#e0e7ff" stroke="#6366f1"/>
  <text x="80" y="527" font-size="11" fill="#334155">Output/Action</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9333ea"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
    <marker id="arrow-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="arrow-indigo" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6366f1"/>
    </marker>
    <marker id="arrow-pink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ec4899"/>
    </marker>
  </defs>
</svg>
